import{u as Be,a as pe,b as He,o as Xe}from"./theme.59733ceb.js";import{r as S,a as C,a1 as we,e as T,c as R,C as Pe,f as ge,h as Ye,x as $e,H as Ie,m as Le,l as Ve,O as We,u as be,J as Ae,p as Oe,i as Te,F as ue,a2 as K,N as de,E as ee,a3 as U,$ as Ge,d as Q,B as xe,w as ce,a4 as je,V as Fe,a5 as De}from"./framework.770d1f77.js";function Ke(e){const a=S(1200);C(()=>{t(),window.addEventListener("resize",n)}),we(()=>{window.removeEventListener("resize",n)});const n=Be(t);function t(){var c;a.value=((c=e.value)==null?void 0:c.getBoundingClientRect().width)||1200}return a}const Ft=T({__name:"vp-demo",props:{source:{},demos:{},path:{}},setup(e){const a=S(),n=Ke(a),t=e,c=R(()=>t.path.startsWith("grid-layout")),d=R(()=>({border:"1px solid black",width:c.value?"":"100%",height:c.value?"":"300px"})),p=R(()=>{const u=Object.keys(t.demos);for(const s of u)if(s.replace("../examples/","").replace(".vue","")===t.path)return t.demos[s].default;return!1});return(u,s)=>{const y=Pe("ClientOnly");return ge(),Ye(ue,null,[$e("section",{ref_key:"wrapRef",ref:a,style:{width:"100%"}},[Ie(y,null,{default:Le(()=>[p.value?(ge(),Ve(Ae(p.value),{key:0,style:We(d.value),width:be(n)},null,8,["style","width"])):Oe("",!0)]),_:1})],512),Te(u.$slots,"source")],64)}}});const he=Symbol("Scene");function A(e,a={},n={},t={}){if(!e)return()=>null;const c=Je(t),d={...a,...n,...c};return p=>K(e,d,p)}const qe=/^nativeOn([A-Z]\S*)/;function Je(e){const a={};let n=!1;Object.entries(e).forEach(([c,d])=>{{n=!0;const p=c.replace(qe,(u,s)=>`on${s}`);a[p]=d}});const t={};return n&&(t.on=a),t.on}function W(e,a,n=1/0){return Math.max(Math.min(e,n),a)}function le(...e){}function _e(e){if(e){if(!e.getElementById("free-dom-style-el")){const a=e.createElement("style");a.id="free-dom-style-el",a.innerHTML=".free-dom-transparent-selection *::selection {all: inherit;}",e.getElementsByTagName("head")[0].appendChild(a)}e.body&&e.body.classList.add("free-dom-transparent-selection")}}function re(e){if(!e)return;e.body&&e.body.classList.remove("free-dom-transparent-selection");const a=e.getSelection();a&&a.removeAllRanges()}function Ue(e,a,n,t,c){const{margin:d,cols:p,rowHeight:u,maxRows:s}=e,y=Ze(e);let h=Math.round((a-d[0])/(y+d[0])),g=Math.round(n-d[1]/(u+d[1]));return h=W(h,0,p-t),g=W(g,0,s-c),{x:h,y:g}}function Ze(e){const{margin:a,containerPadding:n,width:t,cols:c}=e;return(t-a[0]*(c-1)-n[0]*2)/c}const Qe=["xt","xc","xb","yl","yc","yr"],Ce=T({props:{showLine:Boolean},setup(){const e=de(he),a=ee(Qe),n=R(()=>e.diff/e.transformScale),t=e.nodes,c=R(()=>t.filter(h=>!h.node.selected)),d=U({xt:{show:!1,pos:0},xc:{show:!1,pos:0},xb:{show:!1,pos:0},yl:{show:!1,pos:0},yc:{show:!1,pos:0},yr:{show:!1,pos:0}}),p=(h,g)=>{var k;const b=(k=t.find(M=>M.uuid===h))==null?void 0:k.node;b&&(u(),c.value.forEach(M=>{if(M.uuid===h)return;const f=s(b._rect),v=s(M.node._rect);y(f.top,v.top,g)&&(d.xt={show:!0,pos:v.top},b._rect.y=v.top),y(f.bottom,v.top,g)&&(d.xt={show:!0,pos:v.top},b._rect.y=v.top-f.height),y(f.centerY,v.centerY,g)&&(d.xc={show:!0,pos:v.centerY},b._rect.y=v.centerY-f.height/2),y(f.top,v.bottom,g)&&(d.xb={show:!0,pos:v.bottom},b._rect.y=v.bottom),y(f.bottom,v.bottom,g)&&(d.xb={show:!0,pos:v.bottom},b._rect.y=v.bottom-f.height),y(f.left,v.left,g)&&(d.yl={show:!0,pos:v.left},b._rect.x=v.left),y(f.right,v.left,g)&&(d.yl={show:!0,pos:v.left},b._rect.x=v.left-f.width),y(f.centerX,v.centerX,g)&&(d.yc={show:!0,pos:v.centerX},b._rect.x=v.centerX-f.width/2),y(f.left,v.right,g)&&(d.yr={show:!0,pos:v.right},b._rect.x=v.right),y(f.right,v.right,g)&&(d.yr={show:!0,pos:v.right},b._rect.x=v.right-f.width)}))};e==null||e.on("move",p),e==null||e.on("moveup",u),we(()=>{e==null||e.off("move"),e==null||e.off("moveup")});function u(){d.xt.show=!1,d.xc.show=!1,d.xb.show=!1,d.yl.show=!1,d.yc.show=!1,d.yr.show=!1}function s(h){return{deltaX:h.deltaX,deltaY:h.deltaY,top:h.y,bottom:h.y+h.height,left:h.x,right:h.x+h.width,width:h.width,height:h.height,centerX:h.x+h.width/2,centerY:h.y+h.height/2}}function y(h,g,b){const k=b?0:n.value;return Math.abs(h-g)<=k}return{lines:a,diff:n,lineStatus:d}},render(){const e=(n,t)=>K("div",{style:{[n.includes("x")?"top":"left"]:t.pos+"px"},class:[n.includes("x")?"vv-free-dom--xline":"vv-free-dom--yline","vv-free-dom--line"]}),a=this.showLine?this.lines.filter(n=>this.lineStatus[n].show).map(n=>e(n,this.lineStatus[n])):[];return K("div",{class:"vv-free-dom--markline"},a)}});function te(){const e=Ge(),a=typeof e.default=="function"?e.default():e.default,n=a==null?void 0:a[0];return{slots:a,only:n}}function et(e){const a=S(NaN),n=S(NaN);function t(c,d){const p=isNaN(a.value),u=be(e);if(!u)throw new Error("drag node does not exist");return p?{node:u,deltaX:0,deltaY:0,lastX:c,lastY:d,x:c,y:d}:{node:u,deltaX:c-a.value,deltaY:d-n.value,lastX:a.value,lastY:n.value,x:c,y:d}}return{lastX:a,lastY:n,create:t}}function tt(e){const a=S(e.x||e.modelValue.x||0),n=S(e.y||e.modelValue.y||0),t=S(0),c=S(0),d=S();Q(()=>{a.value=e.x||e.modelValue.x||0}),Q(()=>{n.value=e.y||e.modelValue.y||0});const p=(h,g)=>{e.dragStartFn(h,g)},u=(h,g)=>{a.value=Number(g.x.toFixed(2)),n.value=Number(g.y.toFixed(2)),t.value=g.deltaX,c.value=g.deltaY,e.dragFn(h,g)},s=(h,g)=>{const b=d.value=y(g);e.dragStopFn(h,b)};function y(h){return{node:h.node,x:a.value+h.deltaX,y:n.value+h.deltaY,deltaX:h.deltaX,deltaY:h.deltaY,lastX:a.value,lastY:n.value}}return{x:a,y:n,deltaX:t,deltaY:c,create:y,handleDragStart:p,handleDrag:u,handleDragStop:s}}let at=0;function nt(e,a,n){const t=de(he,void 0),c=at++,d=R(()=>(t==null?void 0:t.handle)||n.handle),p=R(()=>(t==null?void 0:t.lockAspectRatio)||n.lockAspectRatio),u=R(()=>(t==null?void 0:t.minWidth)||n.minWidth),s=R(()=>(t==null?void 0:t.minHeight)||n.minHeight),y=R(()=>(t==null?void 0:t.disabledDrag)||n.disabledDrag),h=R(()=>(t==null?void 0:t.disabledResize)||n.disabledResize),g=R(()=>(t==null?void 0:t.disabledSelect)||n.disabledSelect),b=R(()=>(t==null?void 0:t.scale)||n.scale),k=R(()=>(t==null?void 0:t.transformScale)||n.transformScale),M=R(()=>(t==null?void 0:t.fixNonMonospaced)||n.fixNonMonospaced),f=R(()=>(t==null?void 0:t.keyboard)||n.keyboard);C(()=>{const i=e.value;if(!i){console.warn("[free-dom] mounted failed: element not found");return}t==null||t.register(i.$el,c,a)}),xe(()=>{t==null||t.remove(c)});function v(i){return t?t.checkValid(i):!0}function P(i){return t?t.correct(i):i}return{emit:(i,w)=>{t==null||t.emit(i,c,w)},check:v,correct:P,clearSelectState:t==null?void 0:t.clearSelectState,width:t==null?void 0:t.width,height:t==null?void 0:t.height,history:t==null?void 0:t.history,scale:b,handle:d,lockAspectRatio:p,minWidth:u,minHeight:s,disabledDrag:y,disabledResize:h,disabledSelect:g,fixNonMonospaced:M,transformScale:k,keyboard:f}}const q=S({});function fe(){return{on:(t,c)=>{q.value[t]?q.value[t].push(c):q.value[t]=[c]},off:t=>{q.value[t].length=0},emit:(t,...c)=>{(q.value[t]||[]).forEach(p=>p(...c))}}}function lt(e,a){const n=S(c()),t=S(d());Q(()=>{n.value=c()}),Q(()=>{t.value=d()});function c(){return e.width||e.modelValue.w}function d(){return e.height||e.modelValue.h}async function p(u,s,y){if(e.width&&e.height||e.modelValue.w&&e.modelValue.h)return;if(!a.value)return[0,0];u&&await document.fonts.ready;const{width:h,height:g}=window.getComputedStyle(a.value.$el);n.value=Math.max(Math.ceil(parseFloat(h)),s),t.value=Math.max(Math.ceil(parseFloat(g)),y)}return{width:n,height:t,syncSize:p}}function ot(e){const a=ee(e.modelValue);ce(()=>e.modelValue,()=>{a.value=e.modelValue},{deep:!0});const n=R(()=>{var r;return(e.width-d.value[0]*(t.value-1)-(((r=u.value)==null?void 0:r[0])||d.value[0])*2)/e.cols}),t=R(()=>e.cols),c=R(()=>e.rowHeight),d=R(()=>e.margin),p=R(()=>e.maxRows),u=R(()=>e.containerPadding),s=R(()=>e.minW),y=R(()=>e.minH);function h(r){return a.value.find(l=>l.i===r)}function g(){return a.value}function b(r){a.value=r}function k(r,l,m,z,H,Y){if(l.static||l.y===z&&l.x===m)return r;le(`Moving element ${l.i} to [${String(m)},${String(z)}] from [${l.x},${l.y}]`);const D=l.x,X=l.y;typeof m=="number"&&(l.x=m),typeof z=="number"&&(l.y=z),l.moved=!0;const I=P(r).filter(L=>i(L,l));return I.length>0&&Y?(l.x=D,l.y=X,l.moved=!1,r):(I.forEach(L=>{le(`Resolving collision between ${l.i} at [${l.x},${l.y}] and ${L.i} at [${L.x},${L.y}]`,L.moved,L.i),!L.moved&&(L.static?r=M(r,L,l,H):r=M(r,l,L,H))}),r)}function M(r,l,m,z){const H=l.static;if(z){z=!1;const Y={x:m.x,y:Math.max(l.y-m.h,0),w:m.w,h:m.h,i:"-1"};if(!w(r,Y))return le(`Doing reverse collision on ${m.i} up to [${Y.x},${Y.y}].`),k(r,m,void 0,Y.y,z,H)}return k(r,m,void 0,m.y+1,z,H)}function f(r,l,m){const H=k(a.value,r,l,m,!0,!e.collision);return a.value=o(H),a.value}function v(r,l,m){let z=!1;if(!e.collision){const H=a.value.filter(Y=>i(Y,{...r,w:l,h:m}));if(z=H.length>0,z){let Y=1/0,D=1/0;H.forEach(X=>{X.x>r.x&&(Y=Math.min(X.x,Y)),X.y>r.y&&(D=Math.min(X.y,D))}),Number.isFinite(Y)&&(r.w=Y-r.x),Number.isFinite(D)&&(r.h=D-r.y)}}return z||(r.w=l,r.h=m),a.value=o([...a.value]),a.value}function P(r){return r.slice(0).sort((l,m)=>l.y>m.y||l.y===m.y&&l.x>m.x?1:l.y===m.y&&l.x===m.x?0:-1)}function i(r,l){return r.i===l.i||r.x+r.w<=l.x||r.x>=l.x+l.w||r.y+r.h<=l.y?!1:!(r.y>=l.y+l.h)}function w(r,l){for(let m=0;m<r.length;++m)if(i(r[m],l))return r[m]}function o(r){const l=r.filter(H=>H.static),m=P(r),z=new Array(r.length);return m.forEach((H,Y)=>{let D=JSON.parse(JSON.stringify(H));D.static||(D=F(l,D,m),l.push(D)),z[r.indexOf(m[Y])]=D,D.moved=!1}),z}function F(r,l,m){if(e.collision)for(l.y=Math.min(x(r),l.y);l.y>0&&!w(r,l);)--l.y;let z;for(;(z=w(r,l))&&e.collision;)B(m,l,z.y+z.h,"y");return l}function x(r){let l=0;return r.forEach(m=>{const z=m.y+m.h;z>l&&(l=z)}),l}function E(){var l;if(!e.autoHeight)return;const r=x(a.value);return`${r*e.rowHeight+d.value[1]*(r-1)+(((l=u.value)==null?void 0:l[1])||d.value[1])*2}px`}const N={x:"w",y:"h"};function B(r,l,m,z){const H=N[z];l[z]+=1;const Y=r.findIndex(D=>D===l);for(let D=Y+1;D<r.length;++D){const X=r[D];if(X.y>l.y+l.h)break;i(l,X)&&B(r,X,m+l[H],z)}l[z]=m}function _(r){a.value=[...a.value,r]}return{cellWidth:n,cols:t,rowHeight:c,margin:d,maxRows:p,containerPadding:u,minW:s,minH:y,updateDroppingItem:_,calContainerHeight:E,moveTo:f,resizeTo:v,getItem:h,getFull:g,setFull:b,normalize:o}}function it(e,a){const{cellWidth:n,margin:t,rowHeight:c,cols:d,maxRows:p,containerPadding:u}=a,s=S(),y=S(),h=R(()=>u.value||t.value),g=R(()=>s.value?Math.round(s.value.x):Math.round(e.x*(n.value+t.value[0])+h.value[0])),b=R(()=>s.value?Math.round(s.value.y):Math.round(e.y*(c.value+t.value[1])+h.value[1])),k=R(()=>y.value?Math.round(y.value.width):Math.round(n.value*e.width+Math.max(0,e.width-1)*t.value[0])),M=R(()=>y.value?Math.round(y.value.height):Math.round(c.value*e.height+Math.max(0,e.height-1)*t.value[1])),f=R(()=>{const _=a.minW.value;return Math.round(n.value*_+Math.max(0,_-1)*t.value[0])}),v=R(()=>{const _=a.minH.value;return Math.round(c.value*_+Math.max(0,_-1)*t.value[1])}),P=R(()=>({position:"absolute",width:`${k.value}px`,height:`${M.value}px`,transform:`translate(${g.value}px, ${b.value}px)`})),i=(_,{node:r})=>{const l=r.offsetParent.getBoundingClientRect(),m=r.getBoundingClientRect();s.value={x:m.left-l.left+r.offsetParent.scrollLeft,y:m.top-l.top+r.offsetParent.scrollTop}},w=(_,r)=>{if(!s.value)throw new Error("onDrag called before onDragStart");const{deltaX:l,deltaY:m}=r,z=s.value.x+l,H=s.value.y+m;s.value={x:z,y:H};const{x:Y,y:D}=N(z,H);e.dragFn(_,{x:Y,y:D})},o=_=>{if(!s.value)throw new Error("onDragStop called before onDratStart");const{x:r,y:l}=s.value,{x:m,y:z}=N(r,l);s.value=void 0,e.dragEndFn(_,{x:m,y:z})},F=(_,{width:r,height:l})=>{y.value={width:r,height:l}},x=(_,r)=>{const{width:l,height:m}=r,{w:z,h:H}=B(l,m);y.value={width:l,height:m},e.resizeFn(_,{w:z,h:H})},E=(_,r)=>{y.value=void 0;const{width:l,height:m}=r,{w:z,h:H}=B(l,m);e.resizeStopFn(_,{w:z,h:H})};function N(_,r){let l=Math.round((_-t.value[0])/(n.value+t.value[0])),m=Math.round((r-t.value[1])/(c.value+t.value[1]));return l=W(l,0,d.value-e.width),m=W(m,0,p.value-e.height),{x:l,y:m}}function B(_,r){let l=Math.round((_+t.value[0])/(n.value+t.value[0])),m=Math.round((r+t.value[1])/(c.value+t.value[1]));return l=W(l,0,d.value-e.x),m=W(m,0,p.value-e.y),{w:l,h:m}}return{x:g,y:b,width:k,height:M,dragging:s,resizing:y,style:P,minWidth:f,minHeight:v,onDragStart:i,onDrag:w,onDragStop:o,onResizeStart:F,onResize:x,onResizeStop:E}}function st(e,a,n){const t=fe(),c=S(0),d=S(0),p=S(0),u=S(0),s=ze(n),y=S(!1),h=R(()=>{const N=p.value-c.value,B=u.value-d.value;return{visibility:g.value?"visible":"hidden",border:"2px solid rgb(0,120,215)",background:"rgb(0,120,215,0.3)",position:"absolute",top:d.value+(B<0?B:0)+"px",left:c.value+(N<0?N:0)+"px",width:Math.abs(N)+"px",height:Math.abs(B)+"px",zIndex:1}}),g=S(!1),b=pe(e),k=R(()=>{var N;return(N=He(e))==null?void 0:N.ownerDocument}),M=R(()=>n.value.filter(N=>!(a.disabledSelect||N.node.disabledSelect)));function f(){let N;M.value.forEach(B=>{const _=B.node._rect;if(_.x==null||_.y==null||_.width==null||_.height==null)return!1;const r=_.x,l=_.y,m=r+_.width,z=l+_.height,H=v(r,l,m,z);B.node.selected=H,H&&(N=B)}),N==null||N.el.focus()}function v(N,B,_,r){const l=Math.min(c.value,p.value),m=Math.min(d.value,u.value),z=Math.max(c.value,p.value),H=Math.max(d.value,u.value),Y=P(l,z,N,_,Math.abs(N-_)/5),D=P(m,H,B,r,Math.abs(B-r)/5);return Y&&D}function P(N,B,_,r,l){return Math.max(N,_)-Math.min(B,r)<=-l}function i(N){const B=N.clientX-b.x.value,_=N.clientY-b.y.value;return{x:B,y:_}}function w(N){if(a.disabledBatch)return;_e(k.value);const{x:B,y:_}=i(N);g.value=!0,c.value=B,d.value=_,p.value=B,u.value=_,document.addEventListener("mouseup",F)}function o(N){if(!g.value)return;y.value||(t.emit("batch-select","start"),y.value=!0);const{x:B,y:_}=i(N);p.value===B&&u.value===_||(p.value=B,u.value=_,E())}function F(){re(k.value),g.value=!1,y.value=!1,p.value===c.value&&u.value===d.value||(s.push({type:"batch-select"}),setTimeout(()=>{t.emit("batch-select","end",{lastX:p.value,lastY:u.value,startX:c.value,startY:d.value}),p.value=0,u.value=0,c.value=0,d.value=0})),document.removeEventListener("mouseup",F)}function x(){return K("div",{id:"mask",style:h.value})}async function E(){f()}return{selecting:g,renderMask:x,handleMousedown:w,handleMousemove:o}}const oe=S([]),rt=S({canClear:!1});function ze(e){const a=R(()=>{var t;return(t=oe.value.slice(-1)[0])==null?void 0:t.type});function n(t){oe.value.push({...t,data:e})}return{state:rt,records:oe,lastOperate:a,push:n}}function ie(){}const ut={userSelectHack:{type:Boolean,default:!0},startFn:{type:Function,default:ie},stopFn:{type:Function,default:ie},dragFn:{type:Function,default:ie},disabled:Boolean,scale:{type:Number,default:1}},ve=T({name:"FreeDomCore",props:ut,setup(e){const a=S(!1),n=S(),t=R(()=>{var i;return((i=n.value)==null?void 0:i.$el)||n.value}),c=R(()=>{var i;return(i=t.value)==null?void 0:i.ownerDocument}),{lastX:d,lastY:p,create:u}=et(t),s=S(NaN),y=S(NaN);let h,g;xe(()=>{c.value&&(e.userSelectHack&&re(c.value),c.value.removeEventListener("mousemove",v),c.value.removeEventListener("mouseup",f))});function b(i){return M(i)}function k(i){f(i)}function M(i){var x,E;if(e.disabled||!i.target||!(i.target instanceof t.value.ownerDocument.defaultView.Node))return;const{x:w,y:o}=P(i),F=u(w,o);e.startFn(i,F),s.value=w,y.value=o,d.value=w,p.value=o,a.value=!0,e.userSelectHack&&_e(c.value),(x=c.value)==null||x.addEventListener("mousemove",v),(E=c.value)==null||E.addEventListener("mouseup",f)}function f(i){var w,o;if(a.value){if(!(s.value===d.value&&y.value===p.value)){const{x:F,y:x}=P(i),E=u(F,x);e.stopFn(i,E)}e.userSelectHack&&re(c.value),a.value=!1,d.value=NaN,p.value=NaN,(w=c.value)==null||w.removeEventListener("mousemove",v),(o=c.value)==null||o.removeEventListener("mouseup",f)}}function v(i){const{x:w,y:o}=P(i),F=u(w,o);e.dragFn(i,F),d.value=w,p.value=o}function P(i){var E;const w=((E=t.value)==null?void 0:E.offsetParent)||c.value.body,o=w===w.ownerDocument.body;(!h||h!==w)&&(h=w,g=o?{left:0,top:0}:w.getBoundingClientRect());const F=(i.clientX+w.scrollLeft-g.left)/e.scale,x=(i.clientY+w.scrollTop-g.top)/e.scale;return{x:F,y:x}}return{coreRef:n,mousedownFn:b,mouseupFn:k}},render(){const{only:e}=te(),a=A(e,{ref:n=>{this.coreRef=n}},{},{onMousedown:n=>{n.stopPropagation(),this.mousedownFn(n)},onMouseup:this.mouseupFn});return typeof a=="function"?a():a}}),dt=["t","r","l","b","lt","lb","rt","rb"];function se(){}const J={dragOpts:{type:Object,default:()=>({})},width:{type:Number,default:0},height:{type:Number,default:0},scale:{type:[Boolean,Array],default:void 0},startFn:{type:Function,default:se},stopFn:{type:Function,default:se},resizeFn:{type:Function,default:se},minWidth:{type:Number,default:50},minHeight:{type:Number,default:50},lockAspectRatio:Boolean},Ne=T({name:"ResizeDomCore",props:J,setup(e,{slots:a}){const n=R(()=>{const u=e.scale;return Array.isArray(u)?u:dt}),t=ee();function c(u,s,y){const{lockAspectRatio:h}=e;if(!e.minHeight&&!e.minWidth&&!h)return[u,s];if(h&&y.length===2){const g=e.width/e.height;g>1?(s=Math.max(s,e.minHeight),u=s*g):(u=Math.max(u,e.minWidth),s=u/g)}else u=Math.max(u,e.minWidth),s=Math.max(s,e.minHeight);return[u,s]}function d(u,s){return(y,{node:h,deltaX:g,deltaY:b})=>{u==="start"&&(t.value=void 0);const k=s!=="t"&&s!=="b",M=s!=="l"&&s!=="r",f=s[0],v=s[s.length-1],P=h.getBoundingClientRect();t.value=P,f==="l"&&(g=-g),v==="t"&&(b=-b);let i=e.width+(k?g:0),w=e.height+(M?b:0);y.shiftKey||([i,w]=c(i,w,s));const o=i!==e.width||w!==e.height,F=`${u}Fn`,x=typeof e[F]=="function"?e[F]:null;x&&!(u==="resize"&&!o)&&x(y,{node:h,width:i,height:w,handle:s}),u==="stop"&&(t.value=void 0)}}function p(u){return a.handler?()=>{var s;return(s=a.handler)==null?void 0:s.call(a,u)}:()=>K("i",{dataType:"handler",class:["vv-resize-dom--handler",`vv-resize-dom--handler__${u}`]})}return{dots:n,handleResize:d,renderResizehandler:p}},render(){const{slots:e}=te(),a=[...e||[],this.dots.map(n=>A(ve,{class:[this.dragOpts.disabled&&"vv-resize-dom--disabled"]},{...this.dragOpts,stopFn:this.handleResize("stop",n),startFn:this.handleResize("start",n),dragFn:this.handleResize("resize",n)})(this.renderResizehandler(n)))];return A("div",{class:"vv-resize-dom--box"})(a)}});function G(){}const O={modelValue:{type:Object,default:()=>({})},keyboard:Boolean,x:{type:Number,default:0},y:{type:Number,default:0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},handle:{type:String,default:void 0},lockAspectRatio:Boolean,dragStartFn:{type:Function,default:G},dragStopFn:{type:Function,default:G},dragFn:{type:Function,default:G},resizeStartFn:{type:Function,default:G},resizeFn:{type:Function,default:G},resizeStopFn:{type:Function,default:G},autoSize:{type:Boolean,default:!0},minWidth:J.minWidth,minHeight:J.minHeight,disabledDrag:Boolean,disabledResize:Boolean,disabledSelect:Boolean,scale:J.scale,transformScale:{type:Number,default:1},fixNonMonospaced:Boolean},ct=T({name:"FreeDom",props:O,emits:["update:width","update:height","update:x","update:y","update:modelValue"],setup(e,{emit:a,expose:n,slots:t}){const c=S(),d=S(!1);fe().on("batch-select",D=>{d.value=D==="start"});const{x:u,y:s,deltaX:y,deltaY:h,create:g,handleDragStart:b,handleDrag:k,handleDragStop:M}=tt(e),{width:f,height:v,syncSize:P}=lt(e,c),i=S(!1),w=U({disabledSelect:je(e,"disabledSelect"),selected:i,_rect:U({x:u,y:s,width:f,height:v,deltaX:y,deltaY:h}),trigger:D=>{a("update:modelValue",D)},props:e}),o=nt(c,w,e);Xe(c,()=>{!i.value||d.value||(i.value=!1)},{ignore:[o.clearSelectState&&".vv-free-dom--draggable"]});const F=()=>{P(o.fixNonMonospaced.value,o.minWidth.value,o.minHeight.value)},x=S(!1);C(()=>{e.autoSize&&F()});const E=R(()=>({width:`${f.value}px`,height:`${v.value}px`,transform:`translate(${u.value}px, ${s.value}px)`})),N=(D,X)=>{var L;if(!x.value)return;const $=g(X),I={x:$.x,y:$.y,width:f.value,height:v.value};(L=o.check)!=null&&L.call(o,I)&&(k(D,$),o.emit("move",D.shiftKey))},B=(D,X)=>{var V,L;if(!x.value)return;const $={x:u.value,y:s.value,width:f.value,height:v.value};((V=o.check)==null?void 0:V.call(o,$))||(u.value=W(u.value,0,o.width),s.value=W(s.value,0,o.height)),M(D,X),o.emit("moveup"),a("update:x",u.value),a("update:y",s.value),a("update:modelValue",{x:u.value,y:s.value,w:f.value,h:v.value}),(L=o.history)==null||L.push({type:"move-end"})},_=(D,X)=>{const $=o.handle.value;$?$.startsWith(".")?x.value=D.target.classList.contains($.slice(1)):$.startsWith("#")?x.value=D.target.id===$.slice(1):(console.warn(`[free-dom] can not find element with ${$}`),x.value=!0):x.value=!0,x.value&&b(D,X)},r=(D,{node:X,width:$,height:I,handle:V})=>{var me;const L=-($-f.value),ke=-(I-v.value),Me=V[0],Ee=V[V.length-1];let ae=u.value,ne=s.value;Me==="l"&&(ae+=L),Ee==="t"&&(ne+=ke),(me=o.check)!=null&&me.call(o,{x:ae,y:ne,width:$,height:I})&&(f.value=Number($.toFixed(2)),v.value=Number(I.toFixed(2)),u.value=Number(ae.toFixed(2)),s.value=Number(ne.toFixed(2)),e.resizeFn(D,{node:X,width:$,height:I,handle:V}),o==null||o.emit("move"))},l=(D,X)=>{var I,V;((I=o.check)==null?void 0:I.call(o,{x:u.value,y:s.value,width:f.value,height:v.value}))||(u.value=W(u.value,0,o.width),s.value=W(s.value,0,o.height)),e.resizeStopFn(D,X),a("update:width",f.value),a("update:height",v.value),a("update:modelValue",{x:u.value,y:s.value,w:f.value,h:v.value}),o.emit("moveup"),(V=o.history)==null||V.push({type:"resize-end"})},m=(D,X)=>{e.resizeStartFn(D,X)},z=()=>{const D={width:f.value,height:v.value,lockAspectRatio:o.lockAspectRatio.value,dragOpts:{disabled:o.disabledResize.value,scale:o.transformScale.value},startFn:m,resizeFn:r,stopFn:l,minHeight:o.minHeight.value,minWidth:o.minWidth.value,scale:o.scale.value};return A(Ne,{},D)(t)};function H(D){var X,$,I;o.disabledSelect.value||(D.ctrlKey?(i.value=!i.value,(X=o.history)==null||X.push({type:"select"})):i.value||(($=o.clearSelectState)==null||$.call(o),i.value=!0,(I=o.history)==null||I.push({type:"select"})))}function Y(D){var I;if(o.disabledDrag.value||!o.keyboard.value)return;switch(D.preventDefault(),D.key){case"ArrowUp":h.value=-1,y.value=0;break;case"ArrowDown":h.value=1,y.value=0;break;case"ArrowLeft":y.value=-1,h.value=0;break;case"ArrowRight":y.value=1,h.value=0;break;default:y.value=0,h.value=0}u.value+=y.value,s.value+=h.value;const X={x:u.value,y:s.value,width:f.value,height:v.value};((I=o.check)==null?void 0:I.call(o,X))||(u.value=W(u.value,0,o.width),s.value=W(s.value,0,o.height)),a("update:x",u.value),a("update:y",s.value),a("update:modelValue",{x:u.value,y:s.value,w:f.value,h:v.value}),o.emit("move",!0)}return n==null||n({syncSize:F}),{selected:i,domRef:c,style:E,onDragStop:B,onDrag:N,onDragStart:_,resizeNode:z,handleKeyboard:Y,handleSelect:H,disabled:o.disabledDrag,scale:o.transformScale}},render(){var n;const e={startFn:this.onDragStart,stopFn:this.onDragStop,dragFn:this.onDrag,disabled:this.disabled,scale:this.scale},a=()=>this.resizeNode();return(n=A(ve,{ref:"domRef",tabindex:-1,class:["vv-free-dom--draggable",this.disabled&&"vv-free-dom--draggable__disabled",this.selected&&"vv-free-dom--draggable__selected"],style:this.style},e,{nativeOnClick:this.handleSelect,nativeOnKeydown:this.handleKeyboard}))==null?void 0:n(a)}}),ht={diff:{type:Number,default:2},showLine:{type:Boolean,default:!0},transformScale:{type:Number,default:1},keyboard:Boolean,disabledBatch:Boolean,handle:O.handle,minWidth:{type:Number,default:void 0},minHeight:{type:Number,default:void 0},lockAspectRatio:O.lockAspectRatio,disabledDrag:O.disabledDrag,disabledResize:O.disabledResize,disabledSelect:O.disabledSelect,scale:O.scale,fixNonMonospaced:O.fixNonMonospaced},ft=T({name:"FreeDomWrap",props:ht,emits:["batch-select"],setup(e,{emit:a}){const n=fe(),t=S([]),c=ze(t),d=S(0),p=S(0),u=ee(),s=pe(u);ce([s.width,s.height,()=>t.value.length],([i,w])=>{d.value=i,p.value=w,!(!i||!w)&&b()});const y=R(()=>t.value.filter(i=>i.node.selected));n.on("move",i=>{const w=y.value.find(x=>x.uuid===i);if(!w)return;const{deltaX:o,deltaY:F}=w.node._rect;y.value.forEach(x=>{x.uuid!==i&&(x.node._rect.x+=o||0,x.node._rect.y+=F||0)})}),n.on("batch-select",(i,w)=>{i==="end"&&a("batch-select",w)});const h=S(!1),g=st(u,e,t);function b(){t.value.forEach(i=>{const w=e.minWidth||i.node.props.minWidth,o=e.minHeight||i.node.props.minHeight,{x:F,y:x,width:E,height:N}=v(i.node._rect,w,o);i.node._rect.x=F,i.node._rect.y=x,i.node._rect.width=E,i.node._rect.height=N,i.node.trigger({x:F,y:x,w:E,h:N})})}function k(i,w,o){t.value.push({el:i,uuid:w,node:o})}function M(i){const w=t.value.findIndex(o=>o.uuid===i);t.value.splice(w,1)}function f(i){const{x:w,y:o,width:F,height:x}=i;return w>=0&&w+F<=d.value&&o>=0&&o+x<=p.value}function v(i,w,o){let F=Math.max(i.x,0),x=Math.max(i.y,0),E=i.width,N=i.height;return i.x+i.width>d.value&&(F=d.value-i.width,F<0&&(E=Math.max(d.value,w),F=0)),i.y+i.height>p.value&&(x=p.value-i.height,x<0&&(N=Math.max(p.value,o),x=0)),{x:F,y:x,width:E,height:N}}function P(){y.value.forEach(i=>{i.node.selected=!1})}return Fe(he,U({...De(e),nodes:t,width:d,height:p,history:c,clearSelectState:P,register:k,remove:M,checkValid:f,correct:v,on:n.on,off:n.off,emit:n.emit})),{rectRef:u,selecting:h,mask:g,history:c}},render(){const{slots:e}=te(),a=A(Ce,{},{showLine:this.showLine})(),n=[this.mask.selecting&&this.mask.renderMask(),e,a];return A("section",{ref:"rectRef",class:"vv-free-dom--scene"},{},{onMousedown:this.mask.handleMousedown,onMousemove:this.mask.handleMousemove})(n)}}),Re=Symbol("gridLayoutContext"),j=()=>{},vt={x:{type:Number,required:!0},y:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},dragStartFn:{type:Function,default:j},dragFn:{type:Function,default:j},dragEndFn:{type:Function,default:j},resizeStartFn:{type:Function,default:j},resizeFn:{type:Function,default:j},resizeStopFn:{type:Function,default:j},isDraggable:Boolean,isResizable:Boolean,scale:{type:J.scale.type,default:()=>["rb"]},droppingPosition:{type:Object,default:void 0}},mt=["dragMove"],ye=T({name:"GridItem",props:vt,emits:mt,setup(e){const a=S(),n=de(Re);if(!n)throw new Error("TODO");C(()=>{t()}),ce(()=>e.droppingPosition,(o,F)=>{t(F)},{deep:!0});function t(o){var N;if(!e.droppingPosition)return;const F=(N=a.value)==null?void 0:N.$el;if(!F)return;const x=o||{left:0,top:0},E=s.value&&e.droppingPosition.left!==x.left||e.droppingPosition.top!==x.top;if(!s.value)b(e.droppingPosition.evt,{node:F,deltaX:e.droppingPosition.left,deltaY:e.droppingPosition.top,x:0,y:0,lastX:0,lastY:0});else if(E){const B=e.droppingPosition.left-x.left,_=e.droppingPosition.top-x.top;k(e.droppingPosition.evt,{node:F,deltaX:B,deltaY:_,x:0,y:0,lastX:0,lastY:0})}}const{x:c,y:d,width:p,height:u,dragging:s,style:y,minWidth:h,minHeight:g,onDragStart:b,onDrag:k,onDragStop:M,onResizeStart:f,onResize:v,onResizeStop:P}=it(e,n),i=o=>{const F={width:p.value,height:u.value,scale:e.scale,dragOpts:{disabled:!e.isResizable},minWidth:h.value,minHeight:g.value,startFn:f,resizeFn:v,stopFn:P};return A(Ne,{},F)(()=>o)};return{x:c,y:d,width:p,height:u,style:y,dragging:s,onDragStart:b,onDrag:k,onDragStop:M,onResizeStart:f,onResize:v,onResizeStop:P,dragNode:o=>{const F={class:[s.value&&"vv-grid-layout--item__draggable","vv-grid-layout--item",!e.isDraggable&&"vv-grid-layout--item__disabled"],style:y.value,ref:a},x={disabled:!e.isDraggable,startFn:b,stopFn:M,dragFn:k};return A(ve,F,x)(()=>i(o))}}},render(){const{slots:e}=te(),a=e;return this.dragNode(a)}});function gt(e,a){const n=S(),t=S();function c(d){d.preventDefault(),d.stopPropagation();const p=d.currentTarget.getBoundingClientRect(),u=d.clientX-p.left,s=d.clientY-p.top,y={left:u,top:s,evt:d};if(n.value){if(t.value){const{left:h,top:g}=t.value;h!==u&&g!==s&&(t.value=y)}}else{n.value=A("div",{key:a.droppingItem.i}),t.value=y;const h={cols:a.cols,margin:a.margin,maxRows:a.maxRows,rowHeight:a.rowHeight,width:a.width,containerPadding:a.containerPadding||a.margin},g=Ue(h,u,s,a.droppingItem.w,a.droppingItem.h);e.updateDroppingItem({...a.droppingItem,x:g.x,y:g.y,static:!1,isDraggable:!0})}}return{onDropover:c,droppingNode:n,position:t}}const yt={droppable:Boolean,droppingItem:{type:Object,default:()=>({i:"__dropping-elem__",w:1,h:1})},modelValue:{type:Array,required:!0,default:()=>[]},autoHeight:{type:Boolean,default:!0},cols:{type:Number,default:12},maxRows:{type:Number,default:1/0},minW:{type:Number,default:1},minH:{type:Number,default:1},rowHeight:{type:Number,default:150},width:{type:Number,default:1200},margin:{type:Array,default:()=>[10,10]},containerPadding:{type:Array,default:void 0},disabledDrag:Boolean,disabledResize:Boolean,collision:Boolean},pt=T({name:"GridLayout",inheritAttrs:!1,props:yt,emits:["update:modelValue","dropItem"],setup(e,{emit:a}){const n=ot(U(De(e))),t=gt(n,e);Fe(Re,n);const c=S(null);function d(b,k=!1){const M=b.key;if(!M)return;const f=n.getItem(String(M));if(!f)return;const v=!f.static&&!e.disabledDrag,P=!f.static&&!e.disabledResize,i={x:f.x,y:f.y,width:f.w,height:f.h,isDraggable:v,isResizable:P,scale:f.scale,droppingPosition:k?t.position.value:void 0,dragEndFn:(w,o)=>{const{x:F,y:x}=o,E=n.moveTo(f,F,x);a("update:modelValue",E),c.value=null},dragStartFn:()=>{},dragFn:(w,o)=>{if(!f)return;const F={x:f.x,y:f.y,width:f.w,height:f.h},{x,y:E}=o;n.moveTo(f,x,E),c.value=F},resizeFn:(w,o)=>{const F={x:f.x,y:f.y,width:f.w,height:f.h};c.value=F;const{w:x,h:E}=o;n.resizeTo(f,x,E)},resizeStopFn:(w,o)=>{const{w:F,h:x}=o,E=n.resizeTo(f,F,x);a("update:modelValue",E),c.value=null}};return A(ye,{},i)({default:()=>b})}function p(){if(!c.value)return null;const{x:b,y:k,width:M,height:f}=c.value;return A(ye,{class:"vv-grid-layout--placeholder"},{x:b,y:k,width:M,height:f,move:!1})()}function u(){const b=n.getFull(),k=n.normalize(b.filter(M=>M.i!==e.droppingItem.i));n.setFull(k)}let s=0;function y(b){b.stopPropagation(),b.preventDefault();const k=n.getItem(e.droppingItem.i);u(),t.droppingNode.value=null,t.position.value=null,c.value=null,s=0,a("dropItem",k)}function h(b){b.stopPropagation(),b.preventDefault(),--s,s===0&&u()}function g(b){b.stopPropagation(),b.preventDefault(),++s}return{processItem:d,placeholder:p,onDrop:y,onDragLeave:h,onDragEnter:g,layout:n,droppingItem:t}},render(){const e={...this.$attrs.style||{},height:this.layout.calContainerHeight()},n=[...(Array.isArray(this.$attrs.class)?this.$attrs.class:[this.$attrs.class])||[],"vv-grid-layout"],t=typeof this.$slots.default=="function"?this.$slots.default():this.$slots.default||[],c=Se(t);return K("div",{class:n,style:e,onDragover:this.droppable?this.droppingItem.onDropover:Z,onDrop:this.droppable?this.onDrop:Z,onDragleave:this.droppable?this.onDragLeave:Z,onDragenter:this.droppable?this.onDragEnter:Z},[c.map(d=>(d.type===ue&&this.processItem(d),this.processItem(d))),this.droppable&&this.droppingItem.droppingNode.value&&this.processItem(this.droppingItem.droppingNode.value(),!0),this.placeholder()])}});function Z(){}function Se(e){const a=[];return e.forEach(n=>{n.type===ue&&Array.isArray(n.children)?a.push(...Se(n.children)):a.push(n)}),a}const Dt=ft,_t=pt,zt=ct;export{zt as F,_t as G,Ft as _,Dt as a};
