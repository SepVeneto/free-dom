import{u as Re,a as me,b as Ne,o as Se}from"./theme.5631c66d.js";import{r as R,o as ie,a0 as ye,e as O,c as D,C as Me,f as fe,h as Ee,x as He,H as Be,m as Ve,l as $e,J as Xe,O as Ye,u as ge,p as We,i as Le,F as Pe,a1 as q,N as re,E as Z,a2 as Q,$ as Ae,d as U,B as we,w as Ie,V as be,a3 as Oe}from"./framework.469ab03b.js";function Te(e){const a=R(1200);ie(()=>{s(),window.addEventListener("resize",t)}),ye(()=>{window.removeEventListener("resize",t)});const t=Re(s);function s(){var d;a.value=((d=e.value)==null?void 0:d.getBoundingClientRect().width)||1200}return a}const vt=O({__name:"vp-demo",props:{source:{},demos:{},path:{}},setup(e){const a=R(),t=Te(a),s=e,d=D(()=>s.path.startsWith("grid-layout")),c=D(()=>({border:"1px solid black",width:d.value?"":"100%",height:d.value?"":"300px"})),x=D(()=>{const i=Object.keys(s.demos);for(const n of i)if(n.replace("../examples/","").replace(".vue","")===s.path)return s.demos[n].default;return!1});return(i,n)=>{const b=Me("ClientOnly");return fe(),Ee(Pe,null,[He("section",{ref_key:"wrapRef",ref:a,style:{width:"100%"}},[Be(b,null,{default:Ve(()=>[x.value?(fe(),$e(Xe(x.value),{key:0,style:Ye(c.value),width:ge(t)},null,8,["style","width"])):We("",!0)]),_:1})],512),Le(i.$slots,"source")],64)}}});const ue=Symbol("Scene");function P(e,a={},t={},s={}){if(!e)return()=>null;const d={...a,...t};return c=>q(e,d,c)}function A(e,a,t=1/0){return Math.max(Math.min(e,t),a)}function ae(...e){}function pe(e){if(e){if(!e.getElementById("free-dom-style-el")){const a=e.createElement("style");a.id="free-dom-style-el",a.innerHTML=".free-dom-transparent-selection *::selection {all: inherit;}",e.getElementsByTagName("head")[0].appendChild(a)}e.body&&e.body.classList.add("free-dom-transparent-selection")}}function oe(e){if(!e)return;e.body&&e.body.classList.remove("free-dom-transparent-selection");const a=e.getSelection();a&&a.removeAllRanges()}const Ge=["xt","xc","xb","yl","yc","yr"],Ke=O({props:{showLine:Boolean},setup(){const e=re(ue),a=Z(Ge),t=D(()=>e.diff/e.transformScale),s=e.nodes,d=D(()=>s.filter(f=>!f.node.selected)),c=Q({xt:{show:!1,pos:0},xc:{show:!1,pos:0},xb:{show:!1,pos:0},yl:{show:!1,pos:0},yc:{show:!1,pos:0},yr:{show:!1,pos:0}}),x=(f,g)=>{var S;const F=(S=s.find(M=>M.uuid===f))==null?void 0:S.node;F&&(i(),d.value.forEach(M=>{if(M.uuid===f)return;const m=n(F._rect),u=n(M.node._rect);b(m.top,u.top,g)&&(c.xt={show:!0,pos:u.top},F._rect.y=u.top),b(m.bottom,u.top,g)&&(c.xt={show:!0,pos:u.top},F._rect.y=u.top-m.height),b(m.centerY,u.centerY,g)&&(c.xc={show:!0,pos:u.centerY},F._rect.y=u.centerY-m.height/2),b(m.top,u.bottom,g)&&(c.xb={show:!0,pos:u.bottom},F._rect.y=u.bottom),b(m.bottom,u.bottom,g)&&(c.xb={show:!0,pos:u.bottom},F._rect.y=u.bottom-m.height),b(m.left,u.left,g)&&(c.yl={show:!0,pos:u.left},F._rect.x=u.left),b(m.right,u.left,g)&&(c.yl={show:!0,pos:u.left},F._rect.x=u.left-m.width),b(m.centerX,u.centerX,g)&&(c.yc={show:!0,pos:u.centerX},F._rect.x=u.centerX-m.width/2),b(m.left,u.right,g)&&(c.yr={show:!0,pos:u.right},F._rect.x=u.right),b(m.right,u.right,g)&&(c.yr={show:!0,pos:u.right},F._rect.x=u.right-m.width)}))};e==null||e.on("move",x),e==null||e.on("moveup",i),ye(()=>{e==null||e.off("move"),e==null||e.off("moveup")});function i(){c.xt.show=!1,c.xc.show=!1,c.xb.show=!1,c.yl.show=!1,c.yc.show=!1,c.yr.show=!1}function n(f){return{deltaX:f.deltaX,deltaY:f.deltaY,top:f.y,bottom:f.y+f.height,left:f.x,right:f.x+f.width,width:f.width,height:f.height,centerX:f.x+f.width/2,centerY:f.y+f.height/2}}function b(f,g,F){const S=F?0:t.value;return Math.abs(f-g)<=S}return{lines:a,diff:t,lineStatus:c}},render(){const e=(t,s)=>q("div",{style:{[t.includes("x")?"top":"left"]:s.pos+"px"},class:[t.includes("x")?"vv-free-dom--xline":"vv-free-dom--yline","vv-free-dom--line"]}),a=this.showLine?this.lines.filter(t=>this.lineStatus[t].show).map(t=>e(t,this.lineStatus[t])):[];return q("div",{class:"vv-free-dom--markline"},a)}});function C(){const e=Ae(),a=typeof e.default=="function"?e.default():e.default,t=a==null?void 0:a[0];return{slots:a,only:t}}function qe(e){const a=R(NaN),t=R(NaN);function s(d,c){const x=isNaN(a.value),i=ge(e);if(!i)throw new Error("drag node does not exist");return x?{node:i,deltaX:0,deltaY:0,lastX:d,lastY:c,x:d,y:c}:{node:i,deltaX:d-a.value,deltaY:c-t.value,lastX:a.value,lastY:t.value,x:d,y:c}}return{lastX:a,lastY:t,create:s}}function je(e){const a=R(e.x||e.modelValue.x||0),t=R(e.y||e.modelValue.y||0),s=R(0),d=R(0),c=R();U(()=>{a.value=e.x||e.modelValue.x||0}),U(()=>{t.value=e.y||e.modelValue.y||0});const x=(f,g)=>{e.dragStartFn(f,g)},i=(f,g)=>{a.value=g.x,t.value=g.y,s.value=g.deltaX,d.value=g.deltaY,e.dragFn(f,g)},n=(f,g)=>{const F=c.value=b(g);e.dragStopFn(f,F)};function b(f){return{node:f.node,x:a.value+f.deltaX,y:t.value+f.deltaY,deltaX:f.deltaX,deltaY:f.deltaY,lastX:a.value,lastY:t.value}}return{x:a,y:t,deltaX:s,deltaY:d,create:b,handleDragStart:x,handleDrag:i,handleDragStop:n}}let Je=0;function Ue(e,a){const t=re(ue,void 0),s=Je++,d=D(()=>(t==null?void 0:t.handle)||a.handle),c=D(()=>(t==null?void 0:t.lockAspectRatio)||a.lockAspectRatio),x=D(()=>(t==null?void 0:t.minWidth)||a.minWidth),i=D(()=>(t==null?void 0:t.minHeight)||a.minHeight),n=D(()=>(t==null?void 0:t.disabledDrag)||a.disabledDrag),b=D(()=>(t==null?void 0:t.disabledResize)||a.disabledResize),f=D(()=>(t==null?void 0:t.scale)||a.scale),g=D(()=>(t==null?void 0:t.transformScale)||a.transformScale),F=D(()=>(t==null?void 0:t.fixNonMonospaced)||a.fixNonMonospaced),S=D(()=>(t==null?void 0:t.keyboard)||a.keyboard);ie(()=>{t==null||t.register(s,e)}),we(()=>{t==null||t.remove(s)});function M(u){return t?t.checkValid(u):!0}function m(u){return t?t.correct(u):u}return{emit:(u,w)=>{t==null||t.emit(u,s,w)},check:M,correct:m,clearSelectState:t==null?void 0:t.clearSelectState,width:t==null?void 0:t.width,height:t==null?void 0:t.height,history:t==null?void 0:t.history,scale:f,handle:d,lockAspectRatio:c,minWidth:x,minHeight:i,disabledDrag:n,disabledResize:b,fixNonMonospaced:F,transformScale:g,keyboard:S}}const j=R({});function ce(){return{on:(s,d)=>{j.value[s]?j.value[s].push(d):j.value[s]=[d]},off:s=>{j.value[s].length=0},emit:(s,...d)=>{(j.value[s]||[]).forEach(x=>x(...d))}}}function Qe(e,a){const t=R(d()),s=R(c());U(()=>{t.value=d()}),U(()=>{s.value=c()});function d(){return e.width||e.modelValue.w}function c(){return e.height||e.modelValue.h}async function x(i,n,b){if(e.width&&e.height||e.modelValue.w&&e.modelValue.h)return;if(!a.value)return[0,0];i&&await document.fonts.ready;const{width:f,height:g}=window.getComputedStyle(a.value.$el);t.value=Math.max(Math.ceil(parseFloat(f)),n),s.value=Math.max(Math.ceil(parseFloat(g)),b)}return{width:t,height:s,syncSize:x}}function Ze(e){const a=Z(e.modelValue);U(()=>{a.value=e.modelValue});const t=D(()=>{var r;return(e.width-c.value[0]*(s.value-1)-(((r=i.value)==null?void 0:r[0])||c.value[0])*2)/e.cols}),s=D(()=>e.cols),d=D(()=>e.rowHeight),c=D(()=>e.margin),x=D(()=>e.maxRows),i=D(()=>e.containerPadding),n=D(()=>e.minW),b=D(()=>e.minH);function f(r){return a.value.find(l=>l.i===r)}function g(){return a.value}function F(r,l,v,y,k,E){if(l.static||l.y===y&&l.x===v)return r;ae(`Moving element ${l.i} to [${String(v)},${String(y)}] from [${l.x},${l.y}]`);const H=l.x,W=l.y;typeof v=="number"&&(l.x=v),typeof y=="number"&&(l.y=y),l.moved=!0;const Y=u(r).filter(V=>w(V,l));return Y.length>0&&E?(l.x=H,l.y=W,l.moved=!1,r):(Y.forEach(V=>{ae(`Resolving collision between ${l.i} at [${l.x},${l.y}] and ${V.i} at [${V.x},${V.y}]`,V.moved,V.i),!V.moved&&(V.static?r=S(r,V,l,k):r=S(r,l,V,k))}),r)}function S(r,l,v,y){const k=l.static;if(y){y=!1;const E={x:v.x,y:Math.max(l.y-v.h,0),w:v.w,h:v.h,i:"-1"};if(!h(r,E))return ae(`Doing reverse collision on ${v.i} up to [${E.x},${E.y}].`),F(r,v,void 0,E.y,y,k)}return F(r,v,void 0,v.y+1,y,k)}function M(r,l,v){const k=F(a.value,r,l,v,!0,!e.collision);return a.value=p(k),a.value}function m(r,l,v){let y=!1;if(!e.collision){const k=a.value.filter(E=>w(E,{...r,w:l,h:v}));if(y=k.length>0,y){let E=1/0,H=1/0;k.forEach(W=>{W.x>r.x&&(E=Math.min(W.x,E)),W.y>r.y&&(H=Math.min(W.y,H))}),Number.isFinite(E)&&(r.w=E-r.x),Number.isFinite(H)&&(r.h=H-r.y)}}y||(r.w=l,r.h=v),a.value=p([...a.value])}function u(r){return r.slice(0).sort((l,v)=>l.y>v.y||l.y===v.y&&l.x>v.x?1:l.y===v.y&&l.x===v.x?0:-1)}function w(r,l){return r.i===l.i||r.x+r.w<=l.x||r.x>=l.x+l.w||r.y+r.h<=l.y?!1:!(r.y>=l.y+l.h)}function h(r,l){for(let v=0;v<r.length;++v)if(w(r[v],l))return r[v]}function p(r){const l=r.filter(k=>k.static),v=u(r),y=new Array(r.length);return v.forEach((k,E)=>{let H=JSON.parse(JSON.stringify(k));H.static||(H=o(l,H,v),l.push(H)),y[r.indexOf(v[E])]=H,H.moved=!1}),y}function o(r,l,v){if(e.collision)for(l.y=Math.min(N(r),l.y);l.y>0&&!h(r,l);)--l.y;let y;for(;(y=h(r,l))&&e.collision;)$(v,l,y.y+y.h,"y");return l}function N(r){let l=0;return r.forEach(v=>{const y=v.y+v.h;y>l&&(l=y)}),l}function _(){var l;if(!e.autoHeight)return;const r=N(a.value);return`${r*e.rowHeight+c.value[1]*(r-1)+(((l=i.value)==null?void 0:l[1])||c.value[1])*2}px`}const z={x:"w",y:"h"};function $(r,l,v,y){const k=z[y];l[y]+=1;const E=r.findIndex(H=>H===l);for(let H=E+1;H<r.length;++H){const W=r[H];if(W.y>l.y+l.h)break;w(l,W)&&$(r,W,v+l[k],y)}l[y]=v}return{cellWidth:t,cols:s,rowHeight:d,margin:c,maxRows:x,containerPadding:i,minW:n,minH:b,calContainerHeight:_,moveTo:M,resizeTo:m,getItem:f,getFull:g}}function Ce(e,a){const{cellWidth:t,margin:s,rowHeight:d,cols:c,maxRows:x,containerPadding:i}=a,n=R(),b=R(),f=D(()=>i.value||s.value),g=D(()=>n.value?Math.round(n.value.x):Math.round(e.x*(t.value+s.value[0])+f.value[0])),F=D(()=>n.value?Math.round(n.value.y):Math.round(e.y*(d.value+s.value[1])+f.value[1])),S=D(()=>b.value?Math.round(b.value.width):Math.round(t.value*e.width+Math.max(0,e.width-1)*s.value[0])),M=D(()=>b.value?Math.round(b.value.height):Math.round(d.value*e.height+Math.max(0,e.height-1)*s.value[1])),m=D(()=>{const l=a.minW.value;return Math.round(t.value*l+Math.max(0,l-1)*s.value[0])}),u=D(()=>{const l=a.minH.value;return Math.round(d.value*l+Math.max(0,l-1)*s.value[1])}),w=D(()=>({position:"absolute",width:`${S.value}px`,height:`${M.value}px`,transform:`translate(${g.value}px, ${F.value}px)`})),h=(l,{node:v})=>{const y=v.offsetParent.getBoundingClientRect(),k=v.getBoundingClientRect();n.value={x:k.left-y.left+v.offsetParent.scrollLeft,y:k.top-y.top+v.offsetParent.scrollTop}},p=(l,v)=>{if(!n.value)throw new Error("onDrag called before onDragStart");const{deltaX:y,deltaY:k}=v,E=n.value.x+y,H=n.value.y+k;n.value={x:E,y:H};const{x:W,y:B}=$(E,H);e.dragFn(l,{x:W,y:B})},o=l=>{if(!n.value)throw new Error("onDragStop called before onDratStart");const{x:v,y}=n.value,{x:k,y:E}=$(v,y);n.value=void 0,e.dragEndFn(l,{x:k,y:E})},N=(l,{width:v,height:y})=>{b.value={width:v,height:y}},_=(l,v)=>{const{width:y,height:k}=v,{w:E,h:H}=r(y,k);b.value={width:y,height:k},e.resizeFn(l,{w:E,h:H})},z=(l,v)=>{b.value=void 0;const{width:y,height:k}=v,{w:E,h:H}=r(y,k);e.resizeStopFn(l,{w:E,h:H})};function $(l,v){let y=Math.round((l-s.value[0])/(t.value+s.value[0])),k=Math.round((v-s.value[1])/(d.value+s.value[1]));return y=A(y,0,c.value-e.width),k=A(k,0,x.value-e.height),{x:y,y:k}}function r(l,v){let y=Math.round((l+s.value[0])/(t.value+s.value[0])),k=Math.round((v+s.value[1])/(d.value+s.value[1]));return y=A(y,0,c.value-e.x),k=A(k,0,x.value-e.y),{w:y,h:k}}return{x:g,y:F,width:S,height:M,dragging:n,resizing:b,style:w,minWidth:m,minHeight:u,onDragStart:h,onDrag:p,onDragStop:o,onResizeStart:N,onResize:_,onResizeStop:z}}function et(e,a){const t=ce(),s=R(0),d=R(0),c=R(0),x=R(0),i=xe(a),n=R(!1),b=D(()=>{const _=c.value-s.value,z=x.value-d.value;return{visibility:f.value?"visible":"hidden",border:"2px solid rgb(0,120,215)",background:"rgb(0,120,215,0.3)",position:"absolute",top:d.value+(z<0?z:0)+"px",left:s.value+(_<0?_:0)+"px",width:Math.abs(_)+"px",height:Math.abs(z)+"px",zIndex:1}}),f=R(!1),g=me(e),F=D(()=>{var _;return(_=Ne(e))==null?void 0:_.ownerDocument});function S(){a.value.forEach(_=>{const z=_.node._rect;if(z.x==null||z.y==null||z.width==null||z.height==null)return!1;const $=z.x,r=z.y,l=$+z.width,v=r+z.height;_.node.selected=M($,r,l,v)})}function M(_,z,$,r){const l=Math.min(s.value,c.value),v=Math.min(d.value,x.value),y=Math.max(s.value,c.value),k=Math.max(d.value,x.value),E=m(l,y,_,$,Math.abs(_-$)/5),H=m(v,k,z,r,Math.abs(z-r)/5);return E&&H}function m(_,z,$,r,l){return Math.max(_,$)-Math.min(z,r)<=-l}function u(_){const z=_.clientX-g.x.value,$=_.clientY-g.y.value;return{x:z,y:$}}function w(_){pe(F.value);const{x:z,y:$}=u(_);f.value=!0,s.value=z,d.value=$,c.value=z,x.value=$,document.addEventListener("mouseup",p)}function h(_){if(!f.value)return;n.value||(t.emit("batch-select","start"),n.value=!0);const{x:z,y:$}=u(_);c.value===z&&x.value===$||(c.value=z,x.value=$,N())}function p(){oe(F.value),f.value=!1,n.value=!1,c.value===s.value&&x.value===d.value||(i.push({type:"batch-select"}),document.removeEventListener("mouseup",p)),c.value=0,x.value=0,s.value=0,d.value=0,setTimeout(()=>{t.emit("batch-select","end")})}function o(){return q("div",{id:"mask",style:b.value})}async function N(){S()}return{selecting:f,renderMask:o,handleMousedown:w,handleMousemove:h}}const ne=R([]),tt=R({canClear:!1});function xe(e){const a=D(()=>{var s;return(s=ne.value.slice(-1)[0])==null?void 0:s.type});function t(s){ne.value.push({...s,data:e})}return{state:tt,records:ne,lastOperate:a,push:t}}function le(){}const at={userSelectHack:{type:Boolean,default:!0},startFn:{type:Function,default:le},stopFn:{type:Function,default:le},dragFn:{type:Function,default:le},disabled:Boolean,scale:{type:Number,default:1}},de=O({name:"FreeDomCore",props:at,setup(e){const a=R(!1),t=R(),s=D(()=>{var h;return((h=t.value)==null?void 0:h.$el)||t.value}),d=D(()=>{var h;return(h=s.value)==null?void 0:h.ownerDocument}),{lastX:c,lastY:x,create:i}=qe(s),n=R(NaN),b=R(NaN);let f,g;we(()=>{d.value&&(e.userSelectHack&&oe(d.value),d.value.removeEventListener("mousemove",u),d.value.removeEventListener("mouseup",m))});function F(h){return M(h)}function S(h){m(h)}function M(h){var _,z;if(e.disabled||!h.target||!(h.target instanceof s.value.ownerDocument.defaultView.Node))return;const{x:p,y:o}=w(h),N=i(p,o);e.startFn(h,N),n.value=p,b.value=o,c.value=p,x.value=o,a.value=!0,e.userSelectHack&&pe(d.value),(_=d.value)==null||_.addEventListener("mousemove",u),(z=d.value)==null||z.addEventListener("mouseup",m)}function m(h){var p,o;if(a.value){if(!(n.value===c.value&&b.value===x.value)){const{x:N,y:_}=w(h),z=i(N,_);e.stopFn(h,z)}e.userSelectHack&&oe(d.value),a.value=!1,c.value=NaN,x.value=NaN,(p=d.value)==null||p.removeEventListener("mousemove",u),(o=d.value)==null||o.removeEventListener("mouseup",m)}}function u(h){const{x:p,y:o}=w(h),N=i(p,o);e.dragFn(h,N),c.value=p,x.value=o}function w(h){var z;const p=((z=s.value)==null?void 0:z.offsetParent)||d.value.body,o=p===p.ownerDocument.body;(!f||f!==p)&&(f=p,g=o?{left:0,top:0}:p.getBoundingClientRect());const N=(h.clientX+p.scrollLeft-g.left)/e.scale,_=(h.clientY+p.scrollTop-g.top)/e.scale;return{x:N,y:_}}return{coreRef:t,mousedownFn:F,mouseupFn:S}},render(){const{only:e}=C();this.mouseupFn;const a={onMousedown:s=>{s.stopPropagation(),this.mousedownFn(s)},onMouseup:this.mouseupFn},t=P(e,{ref:s=>{this.coreRef=s}},a,{});return typeof t=="function"?t():t}}),nt=["t","r","l","b","lt","lb","rt","rb"];function se(){}const J={dragOpts:{type:Object,default:()=>({})},width:{type:Number,default:0},height:{type:Number,default:0},scale:{type:[Boolean,Array],default:void 0},startFn:{type:Function,default:se},stopFn:{type:Function,default:se},resizeFn:{type:Function,default:se},minWidth:{type:Number,default:50},minHeight:{type:Number,default:50},lockAspectRatio:Boolean},Fe=O({name:"ResizeDomCore",props:J,setup(e,{slots:a}){const t=D(()=>{const i=e.scale;return Array.isArray(i)?i:nt}),s=Z();function d(i,n){const{lockAspectRatio:b}=e;if(!e.minHeight&&!e.minWidth&&!b)return[i,n];if(b){const f=e.width/e.height,g=i-e.width,F=n-e.height;Math.abs(g)>Math.abs(F*f)?n=i/f:i=n*f}return i=Math.max(i,e.minWidth),n=Math.max(n,e.minHeight),[i,n]}function c(i,n){return(b,{node:f,deltaX:g,deltaY:F})=>{i==="start"&&(s.value=void 0);const S=n!=="t"&&n!=="b",M=n!=="l"&&n!=="r",m=n[0],u=n[n.length-1],w=f.getBoundingClientRect();s.value=w,m==="l"&&(g=-g),u==="t"&&(F=-F);let h=e.width+(S?g:0),p=e.height+(M?F:0);[h,p]=d(h,p);const o=h!==e.width||p!==e.height,N=`${i}Fn`,_=typeof e[N]=="function"?e[N]:null;_&&!(i==="resize"&&!o)&&_(b,{node:f,width:h,height:p,handle:n}),i==="stop"&&(s.value=void 0)}}function x(i){return a.handler?()=>{var n;return(n=a.handler)==null?void 0:n.call(a,i)}:()=>q("i",{dataType:"handler",class:["vv-resize-dom--handler",`vv-resize-dom--handler__${i}`]})}return{dots:t,handleResize:c,renderResizehandler:x}},render(){const{slots:e}=C(),a=[...e||[],this.dots.map(t=>P(de,{class:[this.dragOpts.disabled&&"vv-resize-dom--disabled"]},{...this.dragOpts,stopFn:this.handleResize("stop",t),startFn:this.handleResize("start",t),dragFn:this.handleResize("resize",t)})(this.renderResizehandler(t)))];return P("div",{class:"vv-resize-dom--box"})(a)}});function G(){}const I={modelValue:{type:Object,default:()=>({})},keyboard:Boolean,x:{type:Number,default:0},y:{type:Number,default:0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},handle:{type:String,default:void 0},lockAspectRatio:Boolean,dragStartFn:{type:Function,default:G},dragStopFn:{type:Function,default:G},dragFn:{type:Function,default:G},resizeStartFn:{type:Function,default:G},resizeFn:{type:Function,default:G},resizeStopFn:{type:Function,default:G},autoSize:{type:Boolean,default:!0},minWidth:J.minWidth,minHeight:J.minHeight,disabledDrag:Boolean,disabledResize:Boolean,scale:J.scale,transformScale:{type:Number,default:1},fixNonMonospaced:Boolean},lt=O({name:"FreeDom",props:I,emits:["update:width","update:height","update:x","update:y","update:modelValue"],setup(e,{emit:a,expose:t,slots:s}){const d=R(),c=R(!1);ce().on("batch-select",B=>{c.value=B==="start"});const{x:i,y:n,deltaX:b,deltaY:f,create:g,handleDragStart:F,handleDrag:S,handleDragStop:M}=je(e),{width:m,height:u,syncSize:w}=Qe(e,d),h=R(!1),p=Q({selected:h,_rect:Q({x:i,y:n,width:m,height:u,deltaX:b,deltaY:f}),trigger:B=>{a("update:modelValue",B)}}),o=Ue(p,e);Se(d,()=>{!h.value||c.value||(h.value=!1)},{ignore:[o.clearSelectState&&".vv-free-dom--draggable"]});const N=()=>{w(o.fixNonMonospaced.value,o.minWidth.value,o.minHeight.value)},_=R(!1);ie(()=>{e.autoSize&&N()});const z=D(()=>({width:`${m.value}px`,height:`${u.value}px`,transform:`translate(${i.value}px, ${n.value}px)`})),$=(B,Y)=>{var T;if(!_.value)return;const X=g(Y),V={x:X.x,y:X.y,width:m.value,height:u.value};(T=o.check)!=null&&T.call(o,V)&&(S(B,X),o.emit("move",B.shiftKey))},r=(B,Y)=>{var L,T;if(!_.value)return;const X={x:i.value,y:n.value,width:m.value,height:u.value};((L=o.check)==null?void 0:L.call(o,X))||(i.value=A(i.value,0,o.width),n.value=A(n.value,0,o.height)),M(B,Y),o.emit("moveup"),a("update:x",i.value),a("update:y",n.value),a("update:modelValue",{x:i.value,y:n.value,w:m.value,h:u.value}),(T=o.history)==null||T.push({type:"move-end"})},l=(B,Y)=>{const X=o.handle.value;X?X.startsWith(".")?_.value=B.target.classList.contains(X.slice(1)):X.startsWith("#")?_.value=B.target.id===X.slice(1):(console.warn(`[free-dom] can not find element with ${X}`),_.value=!0):_.value=!0,_.value&&F(B,Y)},v=(B,{node:Y,width:X,height:V,handle:L})=>{var he;const T=-(X-m.value),ze=-(V-u.value),ke=L[0],De=L[L.length-1];let ee=i.value,te=n.value;ke==="l"&&(ee+=T),De==="t"&&(te+=ze),(he=o.check)!=null&&he.call(o,{x:ee,y:te,width:X,height:V})&&(m.value=X,u.value=V,i.value=ee,n.value=te,e.resizeFn(B,{node:Y,width:X,height:V,handle:L}),o==null||o.emit("move"))},y=(B,Y)=>{var V,L;((V=o.check)==null?void 0:V.call(o,{x:i.value,y:n.value,width:m.value,height:u.value}))||(i.value=A(i.value,0,o.width),n.value=A(n.value,0,o.height)),e.resizeStopFn(B,Y),a("update:width",m.value),a("update:height",u.value),a("update:modelValue",{x:i.value,y:n.value,w:m.value,h:u.value}),o.emit("moveup"),(L=o.history)==null||L.push({type:"resize-end"})},k=(B,Y)=>{e.resizeStartFn(B,Y)},E=()=>{const B={width:m.value,height:u.value,lockAspectRatio:o.lockAspectRatio.value,dragOpts:{disabled:o.disabledResize.value,scale:o.transformScale.value},startFn:k,resizeFn:v,stopFn:y,minHeight:o.minHeight.value,minWidth:o.minWidth.value,scale:o.scale.value};return P(Fe,{},B)(s)};function H(B){var Y,X,V;B.ctrlKey?(h.value=!h.value,(Y=o.history)==null||Y.push({type:"select"})):h.value||((X=o.clearSelectState)==null||X.call(o),h.value=!0,(V=o.history)==null||V.push({type:"select"}))}function W(B){var V;if(!_.value||!o.keyboard.value)return;switch(B.preventDefault(),B.key){case"ArrowUp":n.value-=1;break;case"ArrowDown":n.value+=1;break;case"ArrowLeft":i.value-=1;break;case"ArrowRight":i.value+=1;break}const Y={x:i.value,y:n.value,width:m.value,height:u.value};((V=o.check)==null?void 0:V.call(o,Y))||(i.value=A(i.value,0,o.width),n.value=A(n.value,0,o.height)),a("update:x",i.value),a("update:y",n.value),a("update:modelValue",{x:i.value,y:n.value,w:m.value,h:u.value}),o.emit("move",!0)}return t==null||t({syncSize:N}),{selected:h,domRef:d,style:z,onDragStop:r,onDrag:$,onDragStart:l,resizeNode:E,handleKeyboard:W,handleSelect:H,disabled:o.disabledDrag,scale:o.transformScale}},render(){var s;const e={startFn:this.onDragStart,stopFn:this.onDragStop,dragFn:this.onDrag,disabled:this.disabled,scale:this.scale,keyboard:this.keyboard};this.handleSelect,this.handleKeyboard;const a={...e,onClick:this.handleSelect,onKeydown:this.handleKeyboard},t=()=>this.resizeNode();return(s=P(de,{ref:"domRef",tabindex:-1,class:["vv-free-dom--draggable",this.disabled&&"vv-free-dom--draggable__disabled",this.selected&&"vv-free-dom--draggable__selected"],style:this.style},a,{}))==null?void 0:s(t)}}),st={diff:{type:Number,default:2},showLine:{type:Boolean,default:!0},transformScale:{type:Number,default:1},keyboard:Boolean,handle:I.handle,minWidth:I.minWidth,minHeight:I.minHeight,lockAspectRatio:I.lockAspectRatio,disabledDrag:I.disabledDrag,disabledResize:I.disabledResize,scale:I.scale,fixNonMonospaced:I.fixNonMonospaced},ot=O({name:"FreeDomWrap",props:st,setup(e){const a=ce(),t=R([]),s=xe(t),d=R(0),c=R(0),x=Z(),i=me(x);Ie([i.width,i.height,()=>t.value.length],([w,h])=>{d.value=w,c.value=h,!(!w||!h)&&g()});const n=D(()=>t.value.filter(w=>w.node.selected));a.on("move",w=>{const h=n.value.find(N=>N.uuid===w);if(!h)return;const{deltaX:p,deltaY:o}=h.node._rect;n.value.forEach(N=>{N.uuid!==w&&(N.node._rect.x+=p||0,N.node._rect.y+=o||0)})});const b=R(!1),f=et(x,t);function g(){t.value.forEach(w=>{const{x:h,y:p,width:o,height:N}=m(w.node._rect);w.node._rect.x=h,w.node._rect.y=p,w.node._rect.width=o,w.node._rect.height=N,w.node.trigger({x:h,y:p,w:o,h:N})})}function F(w,h){t.value.push({uuid:w,node:h})}function S(w){const h=t.value.findIndex(p=>p.uuid===w);t.value.splice(h,1)}function M(w){const{x:h,y:p,width:o,height:N}=w;return h>=0&&h+o<=d.value&&p>=0&&p+N<=c.value}function m(w){let h=Math.max(w.x,0),p=Math.max(w.y,0),o=w.width,N=w.height;return w.x+w.width>d.value&&(h=d.value-w.width,h<0&&(o=d.value,h=0)),w.y+w.height>c.value&&(p=c.value-w.height,p<0&&(N=c.value,p=0)),{x:h,y:p,width:o,height:N}}function u(){n.value.forEach(w=>{w.node.selected=!1})}return be(ue,Q({...Oe(e),nodes:t,width:d,height:c,history:s,clearSelectState:u,register:F,remove:S,checkValid:M,correct:m,on:a.on,off:a.off,emit:a.emit})),{rectRef:x,selecting:b,mask:f,history:s}},render(){const{slots:e}=C(),a=P(Ke,{},{showLine:this.showLine})(),t=[this.mask.selecting&&this.mask.renderMask(),e,a];return P("section",{ref:"rectRef",class:"vv-free-dom--scene"},{onMousedown:this.mask.handleMousedown,onMousemove:this.mask.handleMousemove},{})(t)}}),_e=Symbol("gridLayoutContext"),K=()=>{},it={x:{type:Number,required:!0},y:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},dragStartFn:{type:Function,default:K},dragFn:{type:Function,default:K},dragEndFn:{type:Function,default:K},resizeStartFn:{type:Function,default:K},resizeFn:{type:Function,default:K},resizeStopFn:{type:Function,default:K},isDraggable:Boolean,isResizable:Boolean,scale:{type:J.scale.type,default:()=>["rb"]}},rt=["dragMove"],ve=O({name:"GridItem",props:it,emits:rt,setup(e){const a=re(_e);if(!a)throw new Error("TODO");const{x:t,y:s,width:d,height:c,dragging:x,style:i,minWidth:n,minHeight:b,onDragStart:f,onDrag:g,onDragStop:F,onResizeStart:S,onResize:M,onResizeStop:m}=Ce(e,a),u=h=>{const p={width:d.value,height:c.value,scale:e.scale,dragOpts:{disabled:!e.isResizable},minWidth:n.value,minHeight:b.value,startFn:S,resizeFn:M,stopFn:m};return P(Fe,{},p)(()=>h)};return{x:t,y:s,width:d,height:c,style:i,dragging:x,onDragStart:f,onDrag:g,onDragStop:F,onResizeStart:S,onResize:M,onResizeStop:m,dragNode:h=>{const p={class:[x.value&&"vv-grid-layout--item__draggable","vv-grid-layout--item",!e.isDraggable&&"vv-grid-layout--item__disabled"],style:i.value},o={disabled:!e.isDraggable,startFn:f,stopFn:F,dragFn:g};return P(de,p,o)(()=>u(h))}}},render(){const{slots:e}=C(),a=e;return this.dragNode(a)}}),ut={modelValue:{type:Array,required:!0,default:()=>[]},autoHeight:{type:Boolean,default:!0},cols:{type:Number,default:12},maxRows:{type:Number,default:1/0},minW:{type:Number,default:1},minH:{type:Number,default:1},rowHeight:{type:Number,default:150},width:{type:Number,default:1200},margin:{type:Array,default:()=>[10,10]},containerPadding:{type:Array,default:void 0},disabledDrag:Boolean,disabledResize:Boolean,collision:Boolean},ct=O({name:"GridLayout",inheritAttrs:!1,props:ut,emits:["update:modelValue"],setup(e,{emit:a}){const t=Ze(e);be(_e,t);const s=R(null);function d(x){const i=x.key;if(!i)return;const n=t.getItem(String(i));if(!n)return;const b=!n.static&&!e.disabledDrag,f=!n.static&&!e.disabledResize,g={x:n.x,y:n.y,width:n.w,height:n.h,isDraggable:b,isResizable:f,scale:n.scale,dragEndFn:(F,S)=>{const{x:M,y:m}=S,u=t.moveTo(n,M,m);a("update:modelValue",u),s.value=null},dragStartFn:()=>{},dragFn:(F,S)=>{if(!n)return;const M={x:n.x,y:n.y,width:n.w,height:n.h},{x:m,y:u}=S;t.moveTo(n,m,u),s.value=M},resizeFn:(F,S)=>{const M={x:n.x,y:n.y,width:n.w,height:n.h};s.value=M;const{w:m,h:u}=S;t.resizeTo(n,m,u)},resizeStopFn:(F,S)=>{const{w:M,h:m}=S;t.resizeTo(n,M,m),s.value=null}};return P(ve,{},g)({default:()=>x})}function c(){if(!s.value)return null;const{x,y:i,width:n,height:b}=s.value;return P(ve,{class:"vv-grid-layout--placeholder"},{x,y:i,width:n,height:b,move:!1})()}return{processItem:d,placeholder:c,layout:t}},render(){const e={...this.$attrs.style||{},height:this.layout.calContainerHeight()},a=typeof this.$slots.default=="function"?this.$slots.default():this.$slots.default||[];return q("div",{class:"vv-grid-layout",style:e},[a.map(this.processItem),this.placeholder()])}}),mt=ot,yt=ct,gt=lt;export{gt as F,yt as G,vt as _,mt as a};
