import{u as Ne,a as ye,b as Me,o as Ee}from"./theme.952ca5a3.js";import{r as D,o as ie,a0 as ge,e as P,c as z,C as Be,f as ve,h as He,x as $e,H as Ve,m as Xe,l as Le,J as Ye,O as We,u as we,p as Ae,i as Oe,F as re,a1 as j,N as ue,E as Q,a2 as Z,$ as Ie,d as U,B as be,a3 as Pe,w as Te,V as pe,a4 as Ge}from"./framework.8dee614b.js";function Ke(e){const l=D(1200);ie(()=>{t(),window.addEventListener("resize",n)}),ge(()=>{window.removeEventListener("resize",n)});const n=Ne(t);function t(){var c;l.value=((c=e.value)==null?void 0:c.getBoundingClientRect().width)||1200}return l}const wt=P({__name:"vp-demo",props:{source:{},demos:{},path:{}},setup(e){const l=D(),n=Ke(l),t=e,c=z(()=>t.path.startsWith("grid-layout")),d=z(()=>({border:"1px solid black",width:c.value?"":"100%",height:c.value?"":"300px"})),x=z(()=>{const i=Object.keys(t.demos);for(const s of i)if(s.replace("../examples/","").replace(".vue","")===t.path)return t.demos[s].default;return!1});return(i,s)=>{const m=Be("ClientOnly");return ve(),He(re,null,[$e("section",{ref_key:"wrapRef",ref:l,style:{width:"100%"}},[Ve(m,null,{default:Xe(()=>[x.value?(ve(),Le(Ye(x.value),{key:0,style:We(d.value),width:we(n)},null,8,["style","width"])):Ae("",!0)]),_:1})],512),Oe(i.$slots,"source")],64)}}});const ce=Symbol("Scene");function A(e,l={},n={},t={}){if(!e)return()=>null;const c=qe(t),d={...l,...n,...c};return x=>j(e,d,x)}const je=/^nativeOn([A-Z]\S*)/;function qe(e){const l={};let n=!1;Object.entries(e).forEach(([c,d])=>{{n=!0;const x=c.replace(je,(i,s)=>`on${s}`);l[x]=d}});const t={};return n&&(t.on=l),t.on}function I(e,l,n=1/0){return Math.max(Math.min(e,n),l)}function ae(...e){}function xe(e){if(e){if(!e.getElementById("free-dom-style-el")){const l=e.createElement("style");l.id="free-dom-style-el",l.innerHTML=".free-dom-transparent-selection *::selection {all: inherit;}",e.getElementsByTagName("head")[0].appendChild(l)}e.body&&e.body.classList.add("free-dom-transparent-selection")}}function oe(e){if(!e)return;e.body&&e.body.classList.remove("free-dom-transparent-selection");const l=e.getSelection();l&&l.removeAllRanges()}const Je=["xt","xc","xb","yl","yc","yr"],Ue=P({props:{showLine:Boolean},setup(){const e=ue(ce),l=Q(Je),n=z(()=>e.diff/e.transformScale),t=e.nodes,c=z(()=>t.filter(h=>!h.node.selected)),d=Z({xt:{show:!1,pos:0},xc:{show:!1,pos:0},xb:{show:!1,pos:0},yl:{show:!1,pos:0},yc:{show:!1,pos:0},yr:{show:!1,pos:0}}),x=(h,w)=>{var R;const F=(R=t.find(M=>M.uuid===h))==null?void 0:R.node;F&&(i(),c.value.forEach(M=>{if(M.uuid===h)return;const g=s(F._rect),f=s(M.node._rect);m(g.top,f.top,w)&&(d.xt={show:!0,pos:f.top},F._rect.y=f.top),m(g.bottom,f.top,w)&&(d.xt={show:!0,pos:f.top},F._rect.y=f.top-g.height),m(g.centerY,f.centerY,w)&&(d.xc={show:!0,pos:f.centerY},F._rect.y=f.centerY-g.height/2),m(g.top,f.bottom,w)&&(d.xb={show:!0,pos:f.bottom},F._rect.y=f.bottom),m(g.bottom,f.bottom,w)&&(d.xb={show:!0,pos:f.bottom},F._rect.y=f.bottom-g.height),m(g.left,f.left,w)&&(d.yl={show:!0,pos:f.left},F._rect.x=f.left),m(g.right,f.left,w)&&(d.yl={show:!0,pos:f.left},F._rect.x=f.left-g.width),m(g.centerX,f.centerX,w)&&(d.yc={show:!0,pos:f.centerX},F._rect.x=f.centerX-g.width/2),m(g.left,f.right,w)&&(d.yr={show:!0,pos:f.right},F._rect.x=f.right),m(g.right,f.right,w)&&(d.yr={show:!0,pos:f.right},F._rect.x=f.right-g.width)}))};e==null||e.on("move",x),e==null||e.on("moveup",i),ge(()=>{e==null||e.off("move"),e==null||e.off("moveup")});function i(){d.xt.show=!1,d.xc.show=!1,d.xb.show=!1,d.yl.show=!1,d.yc.show=!1,d.yr.show=!1}function s(h){return{deltaX:h.deltaX,deltaY:h.deltaY,top:h.y,bottom:h.y+h.height,left:h.x,right:h.x+h.width,width:h.width,height:h.height,centerX:h.x+h.width/2,centerY:h.y+h.height/2}}function m(h,w,F){const R=F?0:n.value;return Math.abs(h-w)<=R}return{lines:l,diff:n,lineStatus:d}},render(){const e=(n,t)=>j("div",{style:{[n.includes("x")?"top":"left"]:t.pos+"px"},class:[n.includes("x")?"vv-free-dom--xline":"vv-free-dom--yline","vv-free-dom--line"]}),l=this.showLine?this.lines.filter(n=>this.lineStatus[n].show).map(n=>e(n,this.lineStatus[n])):[];return j("div",{class:"vv-free-dom--markline"},l)}});function C(){const e=Ie(),l=typeof e.default=="function"?e.default():e.default,n=l==null?void 0:l[0];return{slots:l,only:n}}function Ze(e){const l=D(NaN),n=D(NaN);function t(c,d){const x=isNaN(l.value),i=we(e);if(!i)throw new Error("drag node does not exist");return x?{node:i,deltaX:0,deltaY:0,lastX:c,lastY:d,x:c,y:d}:{node:i,deltaX:c-l.value,deltaY:d-n.value,lastX:l.value,lastY:n.value,x:c,y:d}}return{lastX:l,lastY:n,create:t}}function Qe(e){const l=D(e.x||e.modelValue.x||0),n=D(e.y||e.modelValue.y||0),t=D(0),c=D(0),d=D();U(()=>{l.value=e.x||e.modelValue.x||0}),U(()=>{n.value=e.y||e.modelValue.y||0});const x=(h,w)=>{e.dragStartFn(h,w)},i=(h,w)=>{l.value=w.x,n.value=w.y,t.value=w.deltaX,c.value=w.deltaY,e.dragFn(h,w)},s=(h,w)=>{const F=d.value=m(w);e.dragStopFn(h,F)};function m(h){return{node:h.node,x:l.value+h.deltaX,y:n.value+h.deltaY,deltaX:h.deltaX,deltaY:h.deltaY,lastX:l.value,lastY:n.value}}return{x:l,y:n,deltaX:t,deltaY:c,create:m,handleDragStart:x,handleDrag:i,handleDragStop:s}}let Ce=0;function et(e,l,n){const t=ue(ce,void 0),c=Ce++,d=z(()=>(t==null?void 0:t.handle)||n.handle),x=z(()=>(t==null?void 0:t.lockAspectRatio)||n.lockAspectRatio),i=z(()=>(t==null?void 0:t.minWidth)||n.minWidth),s=z(()=>(t==null?void 0:t.minHeight)||n.minHeight),m=z(()=>(t==null?void 0:t.disabledDrag)||n.disabledDrag),h=z(()=>(t==null?void 0:t.disabledResize)||n.disabledResize),w=z(()=>(t==null?void 0:t.disabledSelect)||n.disabledSelect),F=z(()=>(t==null?void 0:t.scale)||n.scale),R=z(()=>(t==null?void 0:t.transformScale)||n.transformScale),M=z(()=>(t==null?void 0:t.fixNonMonospaced)||n.fixNonMonospaced),g=z(()=>(t==null?void 0:t.keyboard)||n.keyboard);ie(()=>{const u=e.value;if(!u){console.warn("[free-dom] mounted failed: element not found");return}t==null||t.register(u.$el,c,l)}),be(()=>{t==null||t.remove(c)});function f(u){return t?t.checkValid(u):!0}function b(u){return t?t.correct(u):u}return{emit:(u,p)=>{t==null||t.emit(u,c,p)},check:f,correct:b,clearSelectState:t==null?void 0:t.clearSelectState,width:t==null?void 0:t.width,height:t==null?void 0:t.height,history:t==null?void 0:t.history,scale:F,handle:d,lockAspectRatio:x,minWidth:i,minHeight:s,disabledDrag:m,disabledResize:h,disabledSelect:w,fixNonMonospaced:M,transformScale:R,keyboard:g}}const q=D({});function de(){return{on:(t,c)=>{q.value[t]?q.value[t].push(c):q.value[t]=[c]},off:t=>{q.value[t].length=0},emit:(t,...c)=>{(q.value[t]||[]).forEach(x=>x(...c))}}}function tt(e,l){const n=D(c()),t=D(d());U(()=>{n.value=c()}),U(()=>{t.value=d()});function c(){return e.width||e.modelValue.w}function d(){return e.height||e.modelValue.h}async function x(i,s,m){if(e.width&&e.height||e.modelValue.w&&e.modelValue.h)return;if(!l.value)return[0,0];i&&await document.fonts.ready;const{width:h,height:w}=window.getComputedStyle(l.value.$el);n.value=Math.max(Math.ceil(parseFloat(h)),s),t.value=Math.max(Math.ceil(parseFloat(w)),m)}return{width:n,height:t,syncSize:x}}function at(e){const l=Q(e.modelValue);U(()=>{l.value=e.modelValue});const n=z(()=>{var o;return(e.width-d.value[0]*(t.value-1)-(((o=i.value)==null?void 0:o[0])||d.value[0])*2)/e.cols}),t=z(()=>e.cols),c=z(()=>e.rowHeight),d=z(()=>e.margin),x=z(()=>e.maxRows),i=z(()=>e.containerPadding),s=z(()=>e.minW),m=z(()=>e.minH);function h(o){return l.value.find(a=>a.i===o)}function w(){return l.value}function F(o,a,v,y,_,E){if(a.static||a.y===y&&a.x===v)return o;ae(`Moving element ${a.i} to [${String(v)},${String(y)}] from [${a.x},${a.y}]`);const N=a.x,Y=a.y;typeof v=="number"&&(a.x=v),typeof y=="number"&&(a.y=y),a.moved=!0;const X=f(o).filter(H=>b(H,a));return X.length>0&&E?(a.x=N,a.y=Y,a.moved=!1,o):(X.forEach(H=>{ae(`Resolving collision between ${a.i} at [${a.x},${a.y}] and ${H.i} at [${H.x},${H.y}]`,H.moved,H.i),!H.moved&&(H.static?o=R(o,H,a,_):o=R(o,a,H,_))}),o)}function R(o,a,v,y){const _=a.static;if(y){y=!1;const E={x:v.x,y:Math.max(a.y-v.h,0),w:v.w,h:v.h,i:"-1"};if(!u(o,E))return ae(`Doing reverse collision on ${v.i} up to [${E.x},${E.y}].`),F(o,v,void 0,E.y,y,_)}return F(o,v,void 0,v.y+1,y,_)}function M(o,a,v){const _=F(l.value,o,a,v,!0,!e.collision);return l.value=p(_),l.value}function g(o,a,v){let y=!1;if(!e.collision){const _=l.value.filter(E=>b(E,{...o,w:a,h:v}));if(y=_.length>0,y){let E=1/0,N=1/0;_.forEach(Y=>{Y.x>o.x&&(E=Math.min(Y.x,E)),Y.y>o.y&&(N=Math.min(Y.y,N))}),Number.isFinite(E)&&(o.w=E-o.x),Number.isFinite(N)&&(o.h=N-o.y)}}return y||(o.w=a,o.h=v),l.value=p([...l.value]),l.value}function f(o){return o.slice(0).sort((a,v)=>a.y>v.y||a.y===v.y&&a.x>v.x?1:a.y===v.y&&a.x===v.x?0:-1)}function b(o,a){return o.i===a.i||o.x+o.w<=a.x||o.x>=a.x+a.w||o.y+o.h<=a.y?!1:!(o.y>=a.y+a.h)}function u(o,a){for(let v=0;v<o.length;++v)if(b(o[v],a))return o[v]}function p(o){const a=o.filter(_=>_.static),v=f(o),y=new Array(o.length);return v.forEach((_,E)=>{let N=JSON.parse(JSON.stringify(_));N.static||(N=r(a,N,v),a.push(N)),y[o.indexOf(v[E])]=N,N.moved=!1}),y}function r(o,a,v){if(e.collision)for(a.y=Math.min(S(o),a.y);a.y>0&&!u(o,a);)--a.y;let y;for(;(y=u(o,a))&&e.collision;)k(v,a,y.y+y.h,"y");return a}function S(o){let a=0;return o.forEach(v=>{const y=v.y+v.h;y>a&&(a=y)}),a}function $(){var a;if(!e.autoHeight)return;const o=S(l.value);return`${o*e.rowHeight+d.value[1]*(o-1)+(((a=i.value)==null?void 0:a[1])||d.value[1])*2}px`}const L={x:"w",y:"h"};function k(o,a,v,y){const _=L[y];a[y]+=1;const E=o.findIndex(N=>N===a);for(let N=E+1;N<o.length;++N){const Y=o[N];if(Y.y>a.y+a.h)break;b(a,Y)&&k(o,Y,v+a[_],y)}a[y]=v}return{cellWidth:n,cols:t,rowHeight:c,margin:d,maxRows:x,containerPadding:i,minW:s,minH:m,calContainerHeight:$,moveTo:M,resizeTo:g,getItem:h,getFull:w}}function nt(e,l){const{cellWidth:n,margin:t,rowHeight:c,cols:d,maxRows:x,containerPadding:i}=l,s=D(),m=D(),h=z(()=>i.value||t.value),w=z(()=>s.value?Math.round(s.value.x):Math.round(e.x*(n.value+t.value[0])+h.value[0])),F=z(()=>s.value?Math.round(s.value.y):Math.round(e.y*(c.value+t.value[1])+h.value[1])),R=z(()=>m.value?Math.round(m.value.width):Math.round(n.value*e.width+Math.max(0,e.width-1)*t.value[0])),M=z(()=>m.value?Math.round(m.value.height):Math.round(c.value*e.height+Math.max(0,e.height-1)*t.value[1])),g=z(()=>{const a=l.minW.value;return Math.round(n.value*a+Math.max(0,a-1)*t.value[0])}),f=z(()=>{const a=l.minH.value;return Math.round(c.value*a+Math.max(0,a-1)*t.value[1])}),b=z(()=>({position:"absolute",width:`${R.value}px`,height:`${M.value}px`,transform:`translate(${w.value}px, ${F.value}px)`})),u=(a,{node:v})=>{const y=v.offsetParent.getBoundingClientRect(),_=v.getBoundingClientRect();s.value={x:_.left-y.left+v.offsetParent.scrollLeft,y:_.top-y.top+v.offsetParent.scrollTop}},p=(a,v)=>{if(!s.value)throw new Error("onDrag called before onDragStart");const{deltaX:y,deltaY:_}=v,E=s.value.x+y,N=s.value.y+_;s.value={x:E,y:N};const{x:Y,y:B}=k(E,N);e.dragFn(a,{x:Y,y:B})},r=a=>{if(!s.value)throw new Error("onDragStop called before onDratStart");const{x:v,y}=s.value,{x:_,y:E}=k(v,y);s.value=void 0,e.dragEndFn(a,{x:_,y:E})},S=(a,{width:v,height:y})=>{m.value={width:v,height:y}},$=(a,v)=>{const{width:y,height:_}=v,{w:E,h:N}=o(y,_);m.value={width:y,height:_},e.resizeFn(a,{w:E,h:N})},L=(a,v)=>{m.value=void 0;const{width:y,height:_}=v,{w:E,h:N}=o(y,_);e.resizeStopFn(a,{w:E,h:N})};function k(a,v){let y=Math.round((a-t.value[0])/(n.value+t.value[0])),_=Math.round((v-t.value[1])/(c.value+t.value[1]));return y=I(y,0,d.value-e.width),_=I(_,0,x.value-e.height),{x:y,y:_}}function o(a,v){let y=Math.round((a+t.value[0])/(n.value+t.value[0])),_=Math.round((v+t.value[1])/(c.value+t.value[1]));return y=I(y,0,d.value-e.x),_=I(_,0,x.value-e.y),{w:y,h:_}}return{x:w,y:F,width:R,height:M,dragging:s,resizing:m,style:b,minWidth:g,minHeight:f,onDragStart:u,onDrag:p,onDragStop:r,onResizeStart:S,onResize:$,onResizeStop:L}}function lt(e,l,n){const t=de(),c=D(0),d=D(0),x=D(0),i=D(0),s=Fe(n),m=D(!1),h=z(()=>{const k=x.value-c.value,o=i.value-d.value;return{visibility:w.value?"visible":"hidden",border:"2px solid rgb(0,120,215)",background:"rgb(0,120,215,0.3)",position:"absolute",top:d.value+(o<0?o:0)+"px",left:c.value+(k<0?k:0)+"px",width:Math.abs(k)+"px",height:Math.abs(o)+"px",zIndex:1}}),w=D(!1),F=ye(e),R=z(()=>{var k;return(k=Me(e))==null?void 0:k.ownerDocument}),M=z(()=>n.value.filter(k=>!(l.disabledSelect||k.node.disabledSelect)));function g(){let k;M.value.forEach(o=>{const a=o.node._rect;if(a.x==null||a.y==null||a.width==null||a.height==null)return!1;const v=a.x,y=a.y,_=v+a.width,E=y+a.height,N=f(v,y,_,E);o.node.selected=N,N&&(k=o)}),k==null||k.el.focus()}function f(k,o,a,v){const y=Math.min(c.value,x.value),_=Math.min(d.value,i.value),E=Math.max(c.value,x.value),N=Math.max(d.value,i.value),Y=b(y,E,k,a,Math.abs(k-a)/5),B=b(_,N,o,v,Math.abs(o-v)/5);return Y&&B}function b(k,o,a,v,y){return Math.max(k,a)-Math.min(o,v)<=-y}function u(k){const o=k.clientX-F.x.value,a=k.clientY-F.y.value;return{x:o,y:a}}function p(k){if(l.disabledBatch)return;xe(R.value);const{x:o,y:a}=u(k);w.value=!0,c.value=o,d.value=a,x.value=o,i.value=a,document.addEventListener("mouseup",S)}function r(k){if(!w.value)return;m.value||(t.emit("batch-select","start"),m.value=!0);const{x:o,y:a}=u(k);x.value===o&&i.value===a||(x.value=o,i.value=a,L())}function S(){oe(R.value),w.value=!1,m.value=!1,x.value===c.value&&i.value===d.value||s.push({type:"batch-select"}),document.removeEventListener("mouseup",S),x.value=0,i.value=0,c.value=0,d.value=0,setTimeout(()=>{t.emit("batch-select","end")})}function $(){return j("div",{id:"mask",style:h.value})}async function L(){g()}return{selecting:w,renderMask:$,handleMousedown:p,handleMousemove:r}}const ne=D([]),st=D({canClear:!1});function Fe(e){const l=z(()=>{var t;return(t=ne.value.slice(-1)[0])==null?void 0:t.type});function n(t){ne.value.push({...t,data:e})}return{state:st,records:ne,lastOperate:l,push:n}}function le(){}const ot={userSelectHack:{type:Boolean,default:!0},startFn:{type:Function,default:le},stopFn:{type:Function,default:le},dragFn:{type:Function,default:le},disabled:Boolean,scale:{type:Number,default:1}},he=P({name:"FreeDomCore",props:ot,setup(e){const l=D(!1),n=D(),t=z(()=>{var u;return((u=n.value)==null?void 0:u.$el)||n.value}),c=z(()=>{var u;return(u=t.value)==null?void 0:u.ownerDocument}),{lastX:d,lastY:x,create:i}=Ze(t),s=D(NaN),m=D(NaN);let h,w;be(()=>{c.value&&(e.userSelectHack&&oe(c.value),c.value.removeEventListener("mousemove",f),c.value.removeEventListener("mouseup",g))});function F(u){return M(u)}function R(u){g(u)}function M(u){var $,L;if(e.disabled||!u.target||!(u.target instanceof t.value.ownerDocument.defaultView.Node))return;const{x:p,y:r}=b(u),S=i(p,r);e.startFn(u,S),s.value=p,m.value=r,d.value=p,x.value=r,l.value=!0,e.userSelectHack&&xe(c.value),($=c.value)==null||$.addEventListener("mousemove",f),(L=c.value)==null||L.addEventListener("mouseup",g)}function g(u){var p,r;if(l.value){if(!(s.value===d.value&&m.value===x.value)){const{x:S,y:$}=b(u),L=i(S,$);e.stopFn(u,L)}e.userSelectHack&&oe(c.value),l.value=!1,d.value=NaN,x.value=NaN,(p=c.value)==null||p.removeEventListener("mousemove",f),(r=c.value)==null||r.removeEventListener("mouseup",g)}}function f(u){const{x:p,y:r}=b(u),S=i(p,r);e.dragFn(u,S),d.value=p,x.value=r}function b(u){var L;const p=((L=t.value)==null?void 0:L.offsetParent)||c.value.body,r=p===p.ownerDocument.body;(!h||h!==p)&&(h=p,w=r?{left:0,top:0}:p.getBoundingClientRect());const S=(u.clientX+p.scrollLeft-w.left)/e.scale,$=(u.clientY+p.scrollTop-w.top)/e.scale;return{x:S,y:$}}return{coreRef:n,mousedownFn:F,mouseupFn:R}},render(){const{only:e}=C(),l=A(e,{ref:n=>{this.coreRef=n}},{},{onMousedown:n=>{n.stopPropagation(),this.mousedownFn(n)},onMouseup:this.mouseupFn});return typeof l=="function"?l():l}}),it=["t","r","l","b","lt","lb","rt","rb"];function se(){}const J={dragOpts:{type:Object,default:()=>({})},width:{type:Number,default:0},height:{type:Number,default:0},scale:{type:[Boolean,Array],default:void 0},startFn:{type:Function,default:se},stopFn:{type:Function,default:se},resizeFn:{type:Function,default:se},minWidth:{type:Number,default:50},minHeight:{type:Number,default:50},lockAspectRatio:Boolean},_e=P({name:"ResizeDomCore",props:J,setup(e,{slots:l}){const n=z(()=>{const i=e.scale;return Array.isArray(i)?i:it}),t=Q();function c(i,s){const{lockAspectRatio:m}=e;if(!e.minHeight&&!e.minWidth&&!m)return[i,s];if(m){const h=e.width/e.height;h>1?(s=Math.max(s,e.minHeight),i=s*h):(i=Math.max(i,e.minWidth),s=i/h)}else i=Math.max(i,e.minWidth),s=Math.max(s,e.minHeight);return[i,s]}function d(i,s){return(m,{node:h,deltaX:w,deltaY:F})=>{i==="start"&&(t.value=void 0);const R=s!=="t"&&s!=="b",M=s!=="l"&&s!=="r",g=s[0],f=s[s.length-1],b=h.getBoundingClientRect();t.value=b,g==="l"&&(w=-w),f==="t"&&(F=-F);let u=e.width+(R?w:0),p=e.height+(M?F:0);m.shiftKey||([u,p]=c(u,p));const r=u!==e.width||p!==e.height,S=`${i}Fn`,$=typeof e[S]=="function"?e[S]:null;$&&!(i==="resize"&&!r)&&$(m,{node:h,width:u,height:p,handle:s}),i==="stop"&&(t.value=void 0)}}function x(i){return l.handler?()=>{var s;return(s=l.handler)==null?void 0:s.call(l,i)}:()=>j("i",{dataType:"handler",class:["vv-resize-dom--handler",`vv-resize-dom--handler__${i}`]})}return{dots:n,handleResize:d,renderResizehandler:x}},render(){const{slots:e}=C(),l=[...e||[],this.dots.map(n=>A(he,{class:[this.dragOpts.disabled&&"vv-resize-dom--disabled"]},{...this.dragOpts,stopFn:this.handleResize("stop",n),startFn:this.handleResize("start",n),dragFn:this.handleResize("resize",n)})(this.renderResizehandler(n)))];return A("div",{class:"vv-resize-dom--box"})(l)}});function G(){}const O={modelValue:{type:Object,default:()=>({})},keyboard:Boolean,x:{type:Number,default:0},y:{type:Number,default:0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},handle:{type:String,default:void 0},lockAspectRatio:Boolean,dragStartFn:{type:Function,default:G},dragStopFn:{type:Function,default:G},dragFn:{type:Function,default:G},resizeStartFn:{type:Function,default:G},resizeFn:{type:Function,default:G},resizeStopFn:{type:Function,default:G},autoSize:{type:Boolean,default:!0},minWidth:J.minWidth,minHeight:J.minHeight,disabledDrag:Boolean,disabledResize:Boolean,disabledSelect:Boolean,scale:J.scale,transformScale:{type:Number,default:1},fixNonMonospaced:Boolean},rt=P({name:"FreeDom",props:O,emits:["update:width","update:height","update:x","update:y","update:modelValue"],setup(e,{emit:l,expose:n,slots:t}){const c=D(),d=D(!1);de().on("batch-select",B=>{d.value=B==="start"});const{x:i,y:s,deltaX:m,deltaY:h,create:w,handleDragStart:F,handleDrag:R,handleDragStop:M}=Qe(e),{width:g,height:f,syncSize:b}=tt(e,c),u=D(!1),p=Z({disabledSelect:Pe(e,"disabledSelect"),selected:u,_rect:Z({x:i,y:s,width:g,height:f,deltaX:m,deltaY:h}),trigger:B=>{l("update:modelValue",B)}}),r=et(c,p,e);Ee(c,()=>{!u.value||d.value||(u.value=!1)},{ignore:[r.clearSelectState&&".vv-free-dom--draggable"]});const S=()=>{b(r.fixNonMonospaced.value,r.minWidth.value,r.minHeight.value)},$=D(!1);ie(()=>{e.autoSize&&S()});const L=z(()=>({width:`${g.value}px`,height:`${f.value}px`,transform:`translate(${i.value}px, ${s.value}px)`})),k=(B,X)=>{var T;if(!$.value)return;const V=w(X),H={x:V.x,y:V.y,width:g.value,height:f.value};(T=r.check)!=null&&T.call(r,H)&&(R(B,V),r.emit("move",B.shiftKey))},o=(B,X)=>{var W,T;if(!$.value)return;const V={x:i.value,y:s.value,width:g.value,height:f.value};((W=r.check)==null?void 0:W.call(r,V))||(i.value=I(i.value,0,r.width),s.value=I(s.value,0,r.height)),M(B,X),r.emit("moveup"),l("update:x",i.value),l("update:y",s.value),l("update:modelValue",{x:i.value,y:s.value,w:g.value,h:f.value}),(T=r.history)==null||T.push({type:"move-end"})},a=(B,X)=>{const V=r.handle.value;V?V.startsWith(".")?$.value=B.target.classList.contains(V.slice(1)):V.startsWith("#")?$.value=B.target.id===V.slice(1):(console.warn(`[free-dom] can not find element with ${V}`),$.value=!0):$.value=!0,$.value&&F(B,X)},v=(B,{node:X,width:V,height:H,handle:W})=>{var fe;const T=-(V-g.value),De=-(H-f.value),Re=W[0],ke=W[W.length-1];let ee=i.value,te=s.value;Re==="l"&&(ee+=T),ke==="t"&&(te+=De),(fe=r.check)!=null&&fe.call(r,{x:ee,y:te,width:V,height:H})&&(g.value=V,f.value=H,i.value=ee,s.value=te,e.resizeFn(B,{node:X,width:V,height:H,handle:W}),r==null||r.emit("move"))},y=(B,X)=>{var H,W;((H=r.check)==null?void 0:H.call(r,{x:i.value,y:s.value,width:g.value,height:f.value}))||(i.value=I(i.value,0,r.width),s.value=I(s.value,0,r.height)),e.resizeStopFn(B,X),l("update:width",g.value),l("update:height",f.value),l("update:modelValue",{x:i.value,y:s.value,w:g.value,h:f.value}),r.emit("moveup"),(W=r.history)==null||W.push({type:"resize-end"})},_=(B,X)=>{e.resizeStartFn(B,X)},E=()=>{const B={width:g.value,height:f.value,lockAspectRatio:r.lockAspectRatio.value,dragOpts:{disabled:r.disabledResize.value,scale:r.transformScale.value},startFn:_,resizeFn:v,stopFn:y,minHeight:r.minHeight.value,minWidth:r.minWidth.value,scale:r.scale.value};return A(_e,{},B)(t)};function N(B){var X,V,H;r.disabledSelect.value||(B.ctrlKey?(u.value=!u.value,(X=r.history)==null||X.push({type:"select"})):u.value||((V=r.clearSelectState)==null||V.call(r),u.value=!0,(H=r.history)==null||H.push({type:"select"})))}function Y(B){var H;if(r.disabledDrag.value||!r.keyboard.value)return;switch(B.preventDefault(),B.key){case"ArrowUp":h.value=-1,m.value=0;break;case"ArrowDown":h.value=1,m.value=0;break;case"ArrowLeft":m.value=-1,h.value=0;break;case"ArrowRight":m.value=1,h.value=0;break;default:m.value=0,h.value=0}i.value+=m.value,s.value+=h.value;const X={x:i.value,y:s.value,width:g.value,height:f.value};((H=r.check)==null?void 0:H.call(r,X))||(i.value=I(i.value,0,r.width),s.value=I(s.value,0,r.height)),l("update:x",i.value),l("update:y",s.value),l("update:modelValue",{x:i.value,y:s.value,w:g.value,h:f.value}),r.emit("move",!0)}return n==null||n({syncSize:S}),{selected:u,domRef:c,style:L,onDragStop:o,onDrag:k,onDragStart:a,resizeNode:E,handleKeyboard:Y,handleSelect:N,disabled:r.disabledDrag,scale:r.transformScale}},render(){var n;const e={startFn:this.onDragStart,stopFn:this.onDragStop,dragFn:this.onDrag,disabled:this.disabled,scale:this.scale},l=()=>this.resizeNode();return(n=A(he,{ref:"domRef",tabindex:-1,class:["vv-free-dom--draggable",this.disabled&&"vv-free-dom--draggable__disabled",this.selected&&"vv-free-dom--draggable__selected"],style:this.style},e,{nativeOnClick:this.handleSelect,nativeOnKeydown:this.handleKeyboard}))==null?void 0:n(l)}}),ut={diff:{type:Number,default:2},showLine:{type:Boolean,default:!0},transformScale:{type:Number,default:1},keyboard:Boolean,disabledBatch:Boolean,handle:O.handle,minWidth:O.minWidth,minHeight:O.minHeight,lockAspectRatio:O.lockAspectRatio,disabledDrag:O.disabledDrag,disabledResize:O.disabledResize,disabledSelect:O.disabledSelect,scale:O.scale,fixNonMonospaced:O.fixNonMonospaced},ct=P({name:"FreeDomWrap",props:ut,setup(e){const l=de(),n=D([]),t=Fe(n),c=D(0),d=D(0),x=Q(),i=ye(x);Te([i.width,i.height,()=>n.value.length],([b,u])=>{c.value=b,d.value=u,!(!b||!u)&&w()});const s=z(()=>n.value.filter(b=>b.node.selected));l.on("move",b=>{const u=s.value.find(S=>S.uuid===b);if(!u)return;const{deltaX:p,deltaY:r}=u.node._rect;s.value.forEach(S=>{S.uuid!==b&&(S.node._rect.x+=p||0,S.node._rect.y+=r||0)})});const m=D(!1),h=lt(x,e,n);function w(){n.value.forEach(b=>{const{x:u,y:p,width:r,height:S}=g(b.node._rect);b.node._rect.x=u,b.node._rect.y=p,b.node._rect.width=r,b.node._rect.height=S,b.node.trigger({x:u,y:p,w:r,h:S})})}function F(b,u,p){n.value.push({el:b,uuid:u,node:p})}function R(b){const u=n.value.findIndex(p=>p.uuid===b);n.value.splice(u,1)}function M(b){const{x:u,y:p,width:r,height:S}=b;return u>=0&&u+r<=c.value&&p>=0&&p+S<=d.value}function g(b){let u=Math.max(b.x,0),p=Math.max(b.y,0),r=b.width,S=b.height;return b.x+b.width>c.value&&(u=c.value-b.width,u<0&&(r=c.value,u=0)),b.y+b.height>d.value&&(p=d.value-b.height,p<0&&(S=d.value,p=0)),{x:u,y:p,width:r,height:S}}function f(){s.value.forEach(b=>{b.node.selected=!1})}return pe(ce,Z({...Ge(e),nodes:n,width:c,height:d,history:t,clearSelectState:f,register:F,remove:R,checkValid:M,correct:g,on:l.on,off:l.off,emit:l.emit})),{rectRef:x,selecting:m,mask:h,history:t}},render(){const{slots:e}=C(),l=A(Ue,{},{showLine:this.showLine})(),n=[this.mask.selecting&&this.mask.renderMask(),e,l];return A("section",{ref:"rectRef",class:"vv-free-dom--scene"},{},{onMousedown:this.mask.handleMousedown,onMousemove:this.mask.handleMousemove})(n)}}),ze=Symbol("gridLayoutContext"),K=()=>{},dt={x:{type:Number,required:!0},y:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},dragStartFn:{type:Function,default:K},dragFn:{type:Function,default:K},dragEndFn:{type:Function,default:K},resizeStartFn:{type:Function,default:K},resizeFn:{type:Function,default:K},resizeStopFn:{type:Function,default:K},isDraggable:Boolean,isResizable:Boolean,scale:{type:J.scale.type,default:()=>["rb"]}},ht=["dragMove"],me=P({name:"GridItem",props:dt,emits:ht,setup(e){const l=ue(ze);if(!l)throw new Error("TODO");const{x:n,y:t,width:c,height:d,dragging:x,style:i,minWidth:s,minHeight:m,onDragStart:h,onDrag:w,onDragStop:F,onResizeStart:R,onResize:M,onResizeStop:g}=nt(e,l),f=u=>{const p={width:c.value,height:d.value,scale:e.scale,dragOpts:{disabled:!e.isResizable},minWidth:s.value,minHeight:m.value,startFn:R,resizeFn:M,stopFn:g};return A(_e,{},p)(()=>u)};return{x:n,y:t,width:c,height:d,style:i,dragging:x,onDragStart:h,onDrag:w,onDragStop:F,onResizeStart:R,onResize:M,onResizeStop:g,dragNode:u=>{const p={class:[x.value&&"vv-grid-layout--item__draggable","vv-grid-layout--item",!e.isDraggable&&"vv-grid-layout--item__disabled"],style:i.value},r={disabled:!e.isDraggable,startFn:h,stopFn:F,dragFn:w};return A(he,p,r)(()=>f(u))}}},render(){const{slots:e}=C(),l=e;return this.dragNode(l)}}),ft={modelValue:{type:Array,required:!0,default:()=>[]},autoHeight:{type:Boolean,default:!0},cols:{type:Number,default:12},maxRows:{type:Number,default:1/0},minW:{type:Number,default:1},minH:{type:Number,default:1},rowHeight:{type:Number,default:150},width:{type:Number,default:1200},margin:{type:Array,default:()=>[10,10]},containerPadding:{type:Array,default:void 0},disabledDrag:Boolean,disabledResize:Boolean,collision:Boolean},vt=P({name:"GridLayout",inheritAttrs:!1,props:ft,emits:["update:modelValue"],setup(e,{emit:l}){const n=at(e);pe(ze,n);const t=D(null);function c(x){const i=x.key;if(!i)return;const s=n.getItem(String(i));if(!s)return;const m=!s.static&&!e.disabledDrag,h=!s.static&&!e.disabledResize,w={x:s.x,y:s.y,width:s.w,height:s.h,isDraggable:m,isResizable:h,scale:s.scale,dragEndFn:(F,R)=>{const{x:M,y:g}=R,f=n.moveTo(s,M,g);l("update:modelValue",f),t.value=null},dragStartFn:()=>{},dragFn:(F,R)=>{if(!s)return;const M={x:s.x,y:s.y,width:s.w,height:s.h},{x:g,y:f}=R;n.moveTo(s,g,f),t.value=M},resizeFn:(F,R)=>{const M={x:s.x,y:s.y,width:s.w,height:s.h};t.value=M;const{w:g,h:f}=R;n.resizeTo(s,g,f)},resizeStopFn:(F,R)=>{const{w:M,h:g}=R,f=n.resizeTo(s,M,g);l("update:modelValue",f),t.value=null}};return A(me,{},w)({default:()=>x})}function d(){if(!t.value)return null;const{x,y:i,width:s,height:m}=t.value;return A(me,{class:"vv-grid-layout--placeholder"},{x,y:i,width:s,height:m,move:!1})()}return{processItem:c,placeholder:d,layout:n}},render(){const e={...this.$attrs.style||{},height:this.layout.calContainerHeight()},n=[...(Array.isArray(this.$attrs.class)?this.$attrs.class:[this.$attrs.class])||[],"vv-grid-layout"],t=typeof this.$slots.default=="function"?this.$slots.default():this.$slots.default||[],c=Se(t);return j("div",{class:n,style:e},[c.map(d=>(d.type===re&&this.processItem(d),this.processItem(d))),this.placeholder()])}});function Se(e){const l=[];return e.forEach(n=>{n.type===re&&Array.isArray(n.children)?l.push(...Se(n.children)):l.push(n)}),l}const bt=ct,pt=vt,xt=rt;export{xt as F,pt as G,wt as _,bt as a};
