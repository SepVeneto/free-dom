import{u as Be,a as pe,b as He,o as Pe}from"./theme.59733ceb.js";import{r as N,a as C,a1 as we,e as T,c as R,C as $e,f as ge,h as Xe,x as Ye,H as Ie,m as Le,l as Ve,O as We,u as be,J as Ae,p as Oe,i as Te,F as ue,a2 as K,N as ce,E as ee,a3 as U,$ as Ge,d as Q,B as xe,w as de,a4 as je,V as Fe,a5 as De}from"./framework.770d1f77.js";function Ke(e){const n=N(1200);C(()=>{t(),window.addEventListener("resize",a)}),we(()=>{window.removeEventListener("resize",a)});const a=Be(t);function t(){var r;n.value=((r=e.value)==null?void 0:r.getBoundingClientRect().width)||1200}return n}const Ft=T({__name:"vp-demo",props:{source:{},demos:{},path:{}},setup(e){const n=N(),a=Ke(n),t=e,r=R(()=>t.path.startsWith("grid-layout")),u=R(()=>({border:"1px solid black",width:r.value?"":"100%",height:r.value?"":"300px"})),x=R(()=>{const c=Object.keys(t.demos);for(const i of c)if(i.replace("../examples/","").replace(".vue","")===t.path)return t.demos[i].default;return!1});return(c,i)=>{const g=$e("ClientOnly");return ge(),Xe(ue,null,[Ye("section",{ref_key:"wrapRef",ref:n,style:{width:"100%"}},[Ie(g,null,{default:Le(()=>[x.value?(ge(),Ve(Ae(x.value),{key:0,style:We(u.value),width:be(a)},null,8,["style","width"])):Oe("",!0)]),_:1})],512),Te(c.$slots,"source")],64)}}});const he=Symbol("Scene");function A(e,n={},a={},t={}){if(!e)return()=>null;const r=Je(t),u={...n,...a,...r};return x=>K(e,u,x)}const qe=/^nativeOn([A-Z]\S*)/;function Je(e){const n={};let a=!1;Object.entries(e).forEach(([r,u])=>{{a=!0;const x=r.replace(qe,(c,i)=>`on${i}`);n[x]=u}});const t={};return a&&(t.on=n),t.on}function W(e,n,a=1/0){return Math.max(Math.min(e,a),n)}function oe(...e){}function _e(e){if(e){if(!e.getElementById("free-dom-style-el")){const n=e.createElement("style");n.id="free-dom-style-el",n.innerHTML=".free-dom-transparent-selection *::selection {all: inherit;}",e.getElementsByTagName("head")[0].appendChild(n)}e.body&&e.body.classList.add("free-dom-transparent-selection")}}function re(e){if(!e)return;e.body&&e.body.classList.remove("free-dom-transparent-selection");const n=e.getSelection();n&&n.removeAllRanges()}function Ue(e,n,a,t,r){const{margin:u,cols:x,rowHeight:c,maxRows:i}=e,g=Ze(e);let h=Math.round((n-u[0])/(g+u[0])),y=Math.round(a-u[1]/(c+u[1]));return h=W(h,0,x-t),y=W(y,0,i-r),{x:h,y}}function Ze(e){const{margin:n,containerPadding:a,width:t,cols:r}=e;return(t-n[0]*(r-1)-a[0]*2)/r}const Qe=["xt","xc","xb","yl","yc","yr"],Ce=T({props:{showLine:Boolean},setup(){const e=ce(he),n=ee(Qe),a=R(()=>e.diff/e.transformScale),t=e.nodes,r=R(()=>t.filter(h=>!h.node.selected)),u=U({xt:{show:!1,pos:0},xc:{show:!1,pos:0},xb:{show:!1,pos:0},yl:{show:!1,pos:0},yc:{show:!1,pos:0},yr:{show:!1,pos:0}}),x=(h,y)=>{var k;const p=(k=t.find(E=>E.uuid===h))==null?void 0:k.node;p&&(c(),r.value.forEach(E=>{if(E.uuid===h)return;const f=i(p._rect),m=i(E.node._rect);g(f.top,m.top,y)&&(u.xt={show:!0,pos:m.top},p._rect.y=m.top),g(f.bottom,m.top,y)&&(u.xt={show:!0,pos:m.top},p._rect.y=m.top-f.height),g(f.centerY,m.centerY,y)&&(u.xc={show:!0,pos:m.centerY},p._rect.y=m.centerY-f.height/2),g(f.top,m.bottom,y)&&(u.xb={show:!0,pos:m.bottom},p._rect.y=m.bottom),g(f.bottom,m.bottom,y)&&(u.xb={show:!0,pos:m.bottom},p._rect.y=m.bottom-f.height),g(f.left,m.left,y)&&(u.yl={show:!0,pos:m.left},p._rect.x=m.left),g(f.right,m.left,y)&&(u.yl={show:!0,pos:m.left},p._rect.x=m.left-f.width),g(f.centerX,m.centerX,y)&&(u.yc={show:!0,pos:m.centerX},p._rect.x=m.centerX-f.width/2),g(f.left,m.right,y)&&(u.yr={show:!0,pos:m.right},p._rect.x=m.right),g(f.right,m.right,y)&&(u.yr={show:!0,pos:m.right},p._rect.x=m.right-f.width)}))};e==null||e.on("move",x),e==null||e.on("moveup",c),we(()=>{e==null||e.off("move"),e==null||e.off("moveup")});function c(){u.xt.show=!1,u.xc.show=!1,u.xb.show=!1,u.yl.show=!1,u.yc.show=!1,u.yr.show=!1}function i(h){return{deltaX:h.deltaX,deltaY:h.deltaY,top:h.y,bottom:h.y+h.height,left:h.x,right:h.x+h.width,width:h.width,height:h.height,centerX:h.x+h.width/2,centerY:h.y+h.height/2}}function g(h,y,p){const k=p?0:a.value;return Math.abs(h-y)<=k}return{lines:n,diff:a,lineStatus:u}},render(){const e=(a,t)=>K("div",{style:{[a.includes("x")?"top":"left"]:t.pos+"px"},class:[a.includes("x")?"vv-free-dom--xline":"vv-free-dom--yline","vv-free-dom--line"]}),n=this.showLine?this.lines.filter(a=>this.lineStatus[a].show).map(a=>e(a,this.lineStatus[a])):[];return K("div",{class:"vv-free-dom--markline"},n)}});function te(){const e=Ge(),n=typeof e.default=="function"?e.default():e.default,a=n==null?void 0:n[0];return{slots:n,only:a}}function et(e){const n=N(NaN),a=N(NaN);function t(r,u){const x=isNaN(n.value),c=be(e);if(!c)throw new Error("drag node does not exist");return x?{node:c,deltaX:0,deltaY:0,lastX:r,lastY:u,x:r,y:u}:{node:c,deltaX:r-n.value,deltaY:u-a.value,lastX:n.value,lastY:a.value,x:r,y:u}}return{lastX:n,lastY:a,create:t}}function tt(e){const n=N(e.x||e.modelValue.x||0),a=N(e.y||e.modelValue.y||0),t=N(0),r=N(0),u=N();Q(()=>{n.value=e.x||e.modelValue.x||0}),Q(()=>{a.value=e.y||e.modelValue.y||0});const x=(h,y)=>{e.dragStartFn(h,y)},c=(h,y)=>{n.value=y.x,a.value=y.y,t.value=y.deltaX,r.value=y.deltaY,e.dragFn(h,y)},i=(h,y)=>{const p=u.value=g(y);e.dragStopFn(h,p)};function g(h){return{node:h.node,x:n.value+h.deltaX,y:a.value+h.deltaY,deltaX:h.deltaX,deltaY:h.deltaY,lastX:n.value,lastY:a.value}}return{x:n,y:a,deltaX:t,deltaY:r,create:g,handleDragStart:x,handleDrag:c,handleDragStop:i}}let nt=0;function at(e,n,a){const t=ce(he,void 0),r=nt++,u=R(()=>(t==null?void 0:t.handle)||a.handle),x=R(()=>(t==null?void 0:t.lockAspectRatio)||a.lockAspectRatio),c=R(()=>(t==null?void 0:t.minWidth)||a.minWidth),i=R(()=>(t==null?void 0:t.minHeight)||a.minHeight),g=R(()=>(t==null?void 0:t.disabledDrag)||a.disabledDrag),h=R(()=>(t==null?void 0:t.disabledResize)||a.disabledResize),y=R(()=>(t==null?void 0:t.disabledSelect)||a.disabledSelect),p=R(()=>(t==null?void 0:t.scale)||a.scale),k=R(()=>(t==null?void 0:t.transformScale)||a.transformScale),E=R(()=>(t==null?void 0:t.fixNonMonospaced)||a.fixNonMonospaced),f=R(()=>(t==null?void 0:t.keyboard)||a.keyboard);C(()=>{const d=e.value;if(!d){console.warn("[free-dom] mounted failed: element not found");return}t==null||t.register(d.$el,r,n)}),xe(()=>{t==null||t.remove(r)});function m(d){return t?t.checkValid(d):!0}function w(d){return t?t.correct(d):d}return{emit:(d,b)=>{t==null||t.emit(d,r,b)},check:m,correct:w,clearSelectState:t==null?void 0:t.clearSelectState,width:t==null?void 0:t.width,height:t==null?void 0:t.height,history:t==null?void 0:t.history,scale:p,handle:u,lockAspectRatio:x,minWidth:c,minHeight:i,disabledDrag:g,disabledResize:h,disabledSelect:y,fixNonMonospaced:E,transformScale:k,keyboard:f}}const q=N({});function fe(){return{on:(t,r)=>{q.value[t]?q.value[t].push(r):q.value[t]=[r]},off:t=>{q.value[t].length=0},emit:(t,...r)=>{(q.value[t]||[]).forEach(x=>x(...r))}}}function ot(e,n){const a=N(r()),t=N(u());Q(()=>{a.value=r()}),Q(()=>{t.value=u()});function r(){return e.width||e.modelValue.w}function u(){return e.height||e.modelValue.h}async function x(c,i,g){if(e.width&&e.height||e.modelValue.w&&e.modelValue.h)return;if(!n.value)return[0,0];c&&await document.fonts.ready;const{width:h,height:y}=window.getComputedStyle(n.value.$el);a.value=Math.max(Math.ceil(parseFloat(h)),i),t.value=Math.max(Math.ceil(parseFloat(y)),g)}return{width:a,height:t,syncSize:x}}function lt(e){const n=ee(e.modelValue);de(()=>e.modelValue,()=>{n.value=e.modelValue},{deep:!0});const a=R(()=>{var s;return(e.width-u.value[0]*(t.value-1)-(((s=c.value)==null?void 0:s[0])||u.value[0])*2)/e.cols}),t=R(()=>e.cols),r=R(()=>e.rowHeight),u=R(()=>e.margin),x=R(()=>e.maxRows),c=R(()=>e.containerPadding),i=R(()=>e.minW),g=R(()=>e.minH);function h(s){return n.value.find(o=>o.i===s)}function y(){return n.value}function p(s){n.value=s}function k(s,o,v,z,H,X){if(o.static||o.y===z&&o.x===v)return s;oe(`Moving element ${o.i} to [${String(v)},${String(z)}] from [${o.x},${o.y}]`);const D=o.x,P=o.y;typeof v=="number"&&(o.x=v),typeof z=="number"&&(o.y=z),o.moved=!0;const I=w(s).filter(L=>d(L,o));return I.length>0&&X?(o.x=D,o.y=P,o.moved=!1,s):(I.forEach(L=>{oe(`Resolving collision between ${o.i} at [${o.x},${o.y}] and ${L.i} at [${L.x},${L.y}]`,L.moved,L.i),!L.moved&&(L.static?s=E(s,L,o,H):s=E(s,o,L,H))}),s)}function E(s,o,v,z){const H=o.static;if(z){z=!1;const X={x:v.x,y:Math.max(o.y-v.h,0),w:v.w,h:v.h,i:"-1"};if(!b(s,X))return oe(`Doing reverse collision on ${v.i} up to [${X.x},${X.y}].`),k(s,v,void 0,X.y,z,H)}return k(s,v,void 0,v.y+1,z,H)}function f(s,o,v){const H=k(n.value,s,o,v,!0,!e.collision);return n.value=l(H),n.value}function m(s,o,v){let z=!1;if(!e.collision){const H=n.value.filter(X=>d(X,{...s,w:o,h:v}));if(z=H.length>0,z){let X=1/0,D=1/0;H.forEach(P=>{P.x>s.x&&(X=Math.min(P.x,X)),P.y>s.y&&(D=Math.min(P.y,D))}),Number.isFinite(X)&&(s.w=X-s.x),Number.isFinite(D)&&(s.h=D-s.y)}}return z||(s.w=o,s.h=v),n.value=l([...n.value]),n.value}function w(s){return s.slice(0).sort((o,v)=>o.y>v.y||o.y===v.y&&o.x>v.x?1:o.y===v.y&&o.x===v.x?0:-1)}function d(s,o){return s.i===o.i||s.x+s.w<=o.x||s.x>=o.x+o.w||s.y+s.h<=o.y?!1:!(s.y>=o.y+o.h)}function b(s,o){for(let v=0;v<s.length;++v)if(d(s[v],o))return s[v]}function l(s){const o=s.filter(H=>H.static),v=w(s),z=new Array(s.length);return v.forEach((H,X)=>{let D=JSON.parse(JSON.stringify(H));D.static||(D=F(o,D,v),o.push(D)),z[s.indexOf(v[X])]=D,D.moved=!1}),z}function F(s,o,v){if(e.collision)for(o.y=Math.min(S(s),o.y);o.y>0&&!b(s,o);)--o.y;let z;for(;(z=b(s,o))&&e.collision;)B(v,o,z.y+z.h,"y");return o}function S(s){let o=0;return s.forEach(v=>{const z=v.y+v.h;z>o&&(o=z)}),o}function $(){var o;if(!e.autoHeight)return;const s=S(n.value);return`${s*e.rowHeight+u.value[1]*(s-1)+(((o=c.value)==null?void 0:o[1])||u.value[1])*2}px`}const M={x:"w",y:"h"};function B(s,o,v,z){const H=M[z];o[z]+=1;const X=s.findIndex(D=>D===o);for(let D=X+1;D<s.length;++D){const P=s[D];if(P.y>o.y+o.h)break;d(o,P)&&B(s,P,v+o[H],z)}o[z]=v}function _(s){n.value=[...n.value,s]}return{cellWidth:a,cols:t,rowHeight:r,margin:u,maxRows:x,containerPadding:c,minW:i,minH:g,updateDroppingItem:_,calContainerHeight:$,moveTo:f,resizeTo:m,getItem:h,getFull:y,setFull:p,normalize:l}}function it(e,n){const{cellWidth:a,margin:t,rowHeight:r,cols:u,maxRows:x,containerPadding:c}=n,i=N(),g=N(),h=R(()=>c.value||t.value),y=R(()=>i.value?Math.round(i.value.x):Math.round(e.x*(a.value+t.value[0])+h.value[0])),p=R(()=>i.value?Math.round(i.value.y):Math.round(e.y*(r.value+t.value[1])+h.value[1])),k=R(()=>g.value?Math.round(g.value.width):Math.round(a.value*e.width+Math.max(0,e.width-1)*t.value[0])),E=R(()=>g.value?Math.round(g.value.height):Math.round(r.value*e.height+Math.max(0,e.height-1)*t.value[1])),f=R(()=>{const _=n.minW.value;return Math.round(a.value*_+Math.max(0,_-1)*t.value[0])}),m=R(()=>{const _=n.minH.value;return Math.round(r.value*_+Math.max(0,_-1)*t.value[1])}),w=R(()=>({position:"absolute",width:`${k.value}px`,height:`${E.value}px`,transform:`translate(${y.value}px, ${p.value}px)`})),d=(_,{node:s})=>{const o=s.offsetParent.getBoundingClientRect(),v=s.getBoundingClientRect();i.value={x:v.left-o.left+s.offsetParent.scrollLeft,y:v.top-o.top+s.offsetParent.scrollTop}},b=(_,s)=>{if(!i.value)throw new Error("onDrag called before onDragStart");const{deltaX:o,deltaY:v}=s,z=i.value.x+o,H=i.value.y+v;i.value={x:z,y:H};const{x:X,y:D}=M(z,H);e.dragFn(_,{x:X,y:D})},l=_=>{if(!i.value)throw new Error("onDragStop called before onDratStart");const{x:s,y:o}=i.value,{x:v,y:z}=M(s,o);i.value=void 0,e.dragEndFn(_,{x:v,y:z})},F=(_,{width:s,height:o})=>{g.value={width:s,height:o}},S=(_,s)=>{const{width:o,height:v}=s,{w:z,h:H}=B(o,v);g.value={width:o,height:v},e.resizeFn(_,{w:z,h:H})},$=(_,s)=>{g.value=void 0;const{width:o,height:v}=s,{w:z,h:H}=B(o,v);e.resizeStopFn(_,{w:z,h:H})};function M(_,s){let o=Math.round((_-t.value[0])/(a.value+t.value[0])),v=Math.round((s-t.value[1])/(r.value+t.value[1]));return o=W(o,0,u.value-e.width),v=W(v,0,x.value-e.height),{x:o,y:v}}function B(_,s){let o=Math.round((_+t.value[0])/(a.value+t.value[0])),v=Math.round((s+t.value[1])/(r.value+t.value[1]));return o=W(o,0,u.value-e.x),v=W(v,0,x.value-e.y),{w:o,h:v}}return{x:y,y:p,width:k,height:E,dragging:i,resizing:g,style:w,minWidth:f,minHeight:m,onDragStart:d,onDrag:b,onDragStop:l,onResizeStart:F,onResize:S,onResizeStop:$}}function st(e,n,a){const t=fe(),r=N(0),u=N(0),x=N(0),c=N(0),i=ze(a),g=N(!1),h=R(()=>{const M=x.value-r.value,B=c.value-u.value;return{visibility:y.value?"visible":"hidden",border:"2px solid rgb(0,120,215)",background:"rgb(0,120,215,0.3)",position:"absolute",top:u.value+(B<0?B:0)+"px",left:r.value+(M<0?M:0)+"px",width:Math.abs(M)+"px",height:Math.abs(B)+"px",zIndex:1}}),y=N(!1),p=pe(e),k=R(()=>{var M;return(M=He(e))==null?void 0:M.ownerDocument}),E=R(()=>a.value.filter(M=>!(n.disabledSelect||M.node.disabledSelect)));function f(){let M;E.value.forEach(B=>{const _=B.node._rect;if(_.x==null||_.y==null||_.width==null||_.height==null)return!1;const s=_.x,o=_.y,v=s+_.width,z=o+_.height,H=m(s,o,v,z);B.node.selected=H,H&&(M=B)}),M==null||M.el.focus()}function m(M,B,_,s){const o=Math.min(r.value,x.value),v=Math.min(u.value,c.value),z=Math.max(r.value,x.value),H=Math.max(u.value,c.value),X=w(o,z,M,_,Math.abs(M-_)/5),D=w(v,H,B,s,Math.abs(B-s)/5);return X&&D}function w(M,B,_,s,o){return Math.max(M,_)-Math.min(B,s)<=-o}function d(M){const B=M.clientX-p.x.value,_=M.clientY-p.y.value;return{x:B,y:_}}function b(M){if(n.disabledBatch)return;_e(k.value);const{x:B,y:_}=d(M);y.value=!0,r.value=B,u.value=_,x.value=B,c.value=_,document.addEventListener("mouseup",F)}function l(M){if(!y.value)return;g.value||(t.emit("batch-select","start"),g.value=!0);const{x:B,y:_}=d(M);x.value===B&&c.value===_||(x.value=B,c.value=_,$())}function F(){re(k.value),y.value=!1,g.value=!1,x.value===r.value&&c.value===u.value||i.push({type:"batch-select"}),document.removeEventListener("mouseup",F),x.value=0,c.value=0,r.value=0,u.value=0,setTimeout(()=>{t.emit("batch-select","end")})}function S(){return K("div",{id:"mask",style:h.value})}async function $(){f()}return{selecting:y,renderMask:S,handleMousedown:b,handleMousemove:l}}const le=N([]),rt=N({canClear:!1});function ze(e){const n=R(()=>{var t;return(t=le.value.slice(-1)[0])==null?void 0:t.type});function a(t){le.value.push({...t,data:e})}return{state:rt,records:le,lastOperate:n,push:a}}function ie(){}const ut={userSelectHack:{type:Boolean,default:!0},startFn:{type:Function,default:ie},stopFn:{type:Function,default:ie},dragFn:{type:Function,default:ie},disabled:Boolean,scale:{type:Number,default:1}},ve=T({name:"FreeDomCore",props:ut,setup(e){const n=N(!1),a=N(),t=R(()=>{var d;return((d=a.value)==null?void 0:d.$el)||a.value}),r=R(()=>{var d;return(d=t.value)==null?void 0:d.ownerDocument}),{lastX:u,lastY:x,create:c}=et(t),i=N(NaN),g=N(NaN);let h,y;xe(()=>{r.value&&(e.userSelectHack&&re(r.value),r.value.removeEventListener("mousemove",m),r.value.removeEventListener("mouseup",f))});function p(d){return E(d)}function k(d){f(d)}function E(d){var S,$;if(e.disabled||!d.target||!(d.target instanceof t.value.ownerDocument.defaultView.Node))return;const{x:b,y:l}=w(d),F=c(b,l);e.startFn(d,F),i.value=b,g.value=l,u.value=b,x.value=l,n.value=!0,e.userSelectHack&&_e(r.value),(S=r.value)==null||S.addEventListener("mousemove",m),($=r.value)==null||$.addEventListener("mouseup",f)}function f(d){var b,l;if(n.value){if(!(i.value===u.value&&g.value===x.value)){const{x:F,y:S}=w(d),$=c(F,S);e.stopFn(d,$)}e.userSelectHack&&re(r.value),n.value=!1,u.value=NaN,x.value=NaN,(b=r.value)==null||b.removeEventListener("mousemove",m),(l=r.value)==null||l.removeEventListener("mouseup",f)}}function m(d){const{x:b,y:l}=w(d),F=c(b,l);e.dragFn(d,F),u.value=b,x.value=l}function w(d){var $;const b=(($=t.value)==null?void 0:$.offsetParent)||r.value.body,l=b===b.ownerDocument.body;(!h||h!==b)&&(h=b,y=l?{left:0,top:0}:b.getBoundingClientRect());const F=(d.clientX+b.scrollLeft-y.left)/e.scale,S=(d.clientY+b.scrollTop-y.top)/e.scale;return{x:F,y:S}}return{coreRef:a,mousedownFn:p,mouseupFn:k}},render(){const{only:e}=te(),n=A(e,{ref:a=>{this.coreRef=a}},{},{onMousedown:a=>{a.stopPropagation(),this.mousedownFn(a)},onMouseup:this.mouseupFn});return typeof n=="function"?n():n}}),ct=["t","r","l","b","lt","lb","rt","rb"];function se(){}const J={dragOpts:{type:Object,default:()=>({})},width:{type:Number,default:0},height:{type:Number,default:0},scale:{type:[Boolean,Array],default:void 0},startFn:{type:Function,default:se},stopFn:{type:Function,default:se},resizeFn:{type:Function,default:se},minWidth:{type:Number,default:50},minHeight:{type:Number,default:50},lockAspectRatio:Boolean},Re=T({name:"ResizeDomCore",props:J,setup(e,{slots:n}){const a=R(()=>{const c=e.scale;return Array.isArray(c)?c:ct}),t=ee();function r(c,i){const{lockAspectRatio:g}=e;if(!e.minHeight&&!e.minWidth&&!g)return[c,i];if(g){const h=e.width/e.height;h>1?(i=Math.max(i,e.minHeight),c=i*h):(c=Math.max(c,e.minWidth),i=c/h)}else c=Math.max(c,e.minWidth),i=Math.max(i,e.minHeight);return[c,i]}function u(c,i){return(g,{node:h,deltaX:y,deltaY:p})=>{c==="start"&&(t.value=void 0);const k=i!=="t"&&i!=="b",E=i!=="l"&&i!=="r",f=i[0],m=i[i.length-1],w=h.getBoundingClientRect();t.value=w,f==="l"&&(y=-y),m==="t"&&(p=-p);let d=e.width+(k?y:0),b=e.height+(E?p:0);g.shiftKey||([d,b]=r(d,b));const l=d!==e.width||b!==e.height,F=`${c}Fn`,S=typeof e[F]=="function"?e[F]:null;S&&!(c==="resize"&&!l)&&S(g,{node:h,width:d,height:b,handle:i}),c==="stop"&&(t.value=void 0)}}function x(c){return n.handler?()=>{var i;return(i=n.handler)==null?void 0:i.call(n,c)}:()=>K("i",{dataType:"handler",class:["vv-resize-dom--handler",`vv-resize-dom--handler__${c}`]})}return{dots:a,handleResize:u,renderResizehandler:x}},render(){const{slots:e}=te(),n=[...e||[],this.dots.map(a=>A(ve,{class:[this.dragOpts.disabled&&"vv-resize-dom--disabled"]},{...this.dragOpts,stopFn:this.handleResize("stop",a),startFn:this.handleResize("start",a),dragFn:this.handleResize("resize",a)})(this.renderResizehandler(a)))];return A("div",{class:"vv-resize-dom--box"})(n)}});function G(){}const O={modelValue:{type:Object,default:()=>({})},keyboard:Boolean,x:{type:Number,default:0},y:{type:Number,default:0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},handle:{type:String,default:void 0},lockAspectRatio:Boolean,dragStartFn:{type:Function,default:G},dragStopFn:{type:Function,default:G},dragFn:{type:Function,default:G},resizeStartFn:{type:Function,default:G},resizeFn:{type:Function,default:G},resizeStopFn:{type:Function,default:G},autoSize:{type:Boolean,default:!0},minWidth:J.minWidth,minHeight:J.minHeight,disabledDrag:Boolean,disabledResize:Boolean,disabledSelect:Boolean,scale:J.scale,transformScale:{type:Number,default:1},fixNonMonospaced:Boolean},dt=T({name:"FreeDom",props:O,emits:["update:width","update:height","update:x","update:y","update:modelValue"],setup(e,{emit:n,expose:a,slots:t}){const r=N(),u=N(!1);fe().on("batch-select",D=>{u.value=D==="start"});const{x:c,y:i,deltaX:g,deltaY:h,create:y,handleDragStart:p,handleDrag:k,handleDragStop:E}=tt(e),{width:f,height:m,syncSize:w}=ot(e,r),d=N(!1),b=U({disabledSelect:je(e,"disabledSelect"),selected:d,_rect:U({x:c,y:i,width:f,height:m,deltaX:g,deltaY:h}),trigger:D=>{n("update:modelValue",D)}}),l=at(r,b,e);Pe(r,()=>{!d.value||u.value||(d.value=!1)},{ignore:[l.clearSelectState&&".vv-free-dom--draggable"]});const F=()=>{w(l.fixNonMonospaced.value,l.minWidth.value,l.minHeight.value)},S=N(!1);C(()=>{e.autoSize&&F()});const $=R(()=>({width:`${f.value}px`,height:`${m.value}px`,transform:`translate(${c.value}px, ${i.value}px)`})),M=(D,P)=>{var L;if(!S.value)return;const Y=y(P),I={x:Y.x,y:Y.y,width:f.value,height:m.value};(L=l.check)!=null&&L.call(l,I)&&(k(D,Y),l.emit("move",D.shiftKey))},B=(D,P)=>{var V,L;if(!S.value)return;const Y={x:c.value,y:i.value,width:f.value,height:m.value};((V=l.check)==null?void 0:V.call(l,Y))||(c.value=W(c.value,0,l.width),i.value=W(i.value,0,l.height)),E(D,P),l.emit("moveup"),n("update:x",c.value),n("update:y",i.value),n("update:modelValue",{x:c.value,y:i.value,w:f.value,h:m.value}),(L=l.history)==null||L.push({type:"move-end"})},_=(D,P)=>{const Y=l.handle.value;Y?Y.startsWith(".")?S.value=D.target.classList.contains(Y.slice(1)):Y.startsWith("#")?S.value=D.target.id===Y.slice(1):(console.warn(`[free-dom] can not find element with ${Y}`),S.value=!0):S.value=!0,S.value&&p(D,P)},s=(D,{node:P,width:Y,height:I,handle:V})=>{var me;const L=-(Y-f.value),ke=-(I-m.value),Me=V[0],Ee=V[V.length-1];let ne=c.value,ae=i.value;Me==="l"&&(ne+=L),Ee==="t"&&(ae+=ke),(me=l.check)!=null&&me.call(l,{x:ne,y:ae,width:Y,height:I})&&(f.value=Y,m.value=I,c.value=ne,i.value=ae,e.resizeFn(D,{node:P,width:Y,height:I,handle:V}),l==null||l.emit("move"))},o=(D,P)=>{var I,V;((I=l.check)==null?void 0:I.call(l,{x:c.value,y:i.value,width:f.value,height:m.value}))||(c.value=W(c.value,0,l.width),i.value=W(i.value,0,l.height)),e.resizeStopFn(D,P),n("update:width",f.value),n("update:height",m.value),n("update:modelValue",{x:c.value,y:i.value,w:f.value,h:m.value}),l.emit("moveup"),(V=l.history)==null||V.push({type:"resize-end"})},v=(D,P)=>{e.resizeStartFn(D,P)},z=()=>{const D={width:f.value,height:m.value,lockAspectRatio:l.lockAspectRatio.value,dragOpts:{disabled:l.disabledResize.value,scale:l.transformScale.value},startFn:v,resizeFn:s,stopFn:o,minHeight:l.minHeight.value,minWidth:l.minWidth.value,scale:l.scale.value};return A(Re,{},D)(t)};function H(D){var P,Y,I;l.disabledSelect.value||(D.ctrlKey?(d.value=!d.value,(P=l.history)==null||P.push({type:"select"})):d.value||((Y=l.clearSelectState)==null||Y.call(l),d.value=!0,(I=l.history)==null||I.push({type:"select"})))}function X(D){var I;if(l.disabledDrag.value||!l.keyboard.value)return;switch(D.preventDefault(),D.key){case"ArrowUp":h.value=-1,g.value=0;break;case"ArrowDown":h.value=1,g.value=0;break;case"ArrowLeft":g.value=-1,h.value=0;break;case"ArrowRight":g.value=1,h.value=0;break;default:g.value=0,h.value=0}c.value+=g.value,i.value+=h.value;const P={x:c.value,y:i.value,width:f.value,height:m.value};((I=l.check)==null?void 0:I.call(l,P))||(c.value=W(c.value,0,l.width),i.value=W(i.value,0,l.height)),n("update:x",c.value),n("update:y",i.value),n("update:modelValue",{x:c.value,y:i.value,w:f.value,h:m.value}),l.emit("move",!0)}return a==null||a({syncSize:F}),{selected:d,domRef:r,style:$,onDragStop:B,onDrag:M,onDragStart:_,resizeNode:z,handleKeyboard:X,handleSelect:H,disabled:l.disabledDrag,scale:l.transformScale}},render(){var a;const e={startFn:this.onDragStart,stopFn:this.onDragStop,dragFn:this.onDrag,disabled:this.disabled,scale:this.scale},n=()=>this.resizeNode();return(a=A(ve,{ref:"domRef",tabindex:-1,class:["vv-free-dom--draggable",this.disabled&&"vv-free-dom--draggable__disabled",this.selected&&"vv-free-dom--draggable__selected"],style:this.style},e,{nativeOnClick:this.handleSelect,nativeOnKeydown:this.handleKeyboard}))==null?void 0:a(n)}}),ht={diff:{type:Number,default:2},showLine:{type:Boolean,default:!0},transformScale:{type:Number,default:1},keyboard:Boolean,disabledBatch:Boolean,handle:O.handle,minWidth:O.minWidth,minHeight:O.minHeight,lockAspectRatio:O.lockAspectRatio,disabledDrag:O.disabledDrag,disabledResize:O.disabledResize,disabledSelect:O.disabledSelect,scale:O.scale,fixNonMonospaced:O.fixNonMonospaced},ft=T({name:"FreeDomWrap",props:ht,setup(e){const n=fe(),a=N([]),t=ze(a),r=N(0),u=N(0),x=ee(),c=pe(x);de([c.width,c.height,()=>a.value.length],([w,d])=>{r.value=w,u.value=d,!(!w||!d)&&y()});const i=R(()=>a.value.filter(w=>w.node.selected));n.on("move",w=>{const d=i.value.find(F=>F.uuid===w);if(!d)return;const{deltaX:b,deltaY:l}=d.node._rect;i.value.forEach(F=>{F.uuid!==w&&(F.node._rect.x+=b||0,F.node._rect.y+=l||0)})});const g=N(!1),h=st(x,e,a);function y(){a.value.forEach(w=>{const{x:d,y:b,width:l,height:F}=f(w.node._rect);w.node._rect.x=d,w.node._rect.y=b,w.node._rect.width=l,w.node._rect.height=F,w.node.trigger({x:d,y:b,w:l,h:F})})}function p(w,d,b){a.value.push({el:w,uuid:d,node:b})}function k(w){const d=a.value.findIndex(b=>b.uuid===w);a.value.splice(d,1)}function E(w){const{x:d,y:b,width:l,height:F}=w;return d>=0&&d+l<=r.value&&b>=0&&b+F<=u.value}function f(w){let d=Math.max(w.x,0),b=Math.max(w.y,0),l=w.width,F=w.height;return w.x+w.width>r.value&&(d=r.value-w.width,d<0&&(l=r.value,d=0)),w.y+w.height>u.value&&(b=u.value-w.height,b<0&&(F=u.value,b=0)),{x:d,y:b,width:l,height:F}}function m(){i.value.forEach(w=>{w.node.selected=!1})}return Fe(he,U({...De(e),nodes:a,width:r,height:u,history:t,clearSelectState:m,register:p,remove:k,checkValid:E,correct:f,on:n.on,off:n.off,emit:n.emit})),{rectRef:x,selecting:g,mask:h,history:t}},render(){const{slots:e}=te(),n=A(Ce,{},{showLine:this.showLine})(),a=[this.mask.selecting&&this.mask.renderMask(),e,n];return A("section",{ref:"rectRef",class:"vv-free-dom--scene"},{},{onMousedown:this.mask.handleMousedown,onMousemove:this.mask.handleMousemove})(a)}}),Se=Symbol("gridLayoutContext"),j=()=>{},vt={x:{type:Number,required:!0},y:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},dragStartFn:{type:Function,default:j},dragFn:{type:Function,default:j},dragEndFn:{type:Function,default:j},resizeStartFn:{type:Function,default:j},resizeFn:{type:Function,default:j},resizeStopFn:{type:Function,default:j},isDraggable:Boolean,isResizable:Boolean,scale:{type:J.scale.type,default:()=>["rb"]},droppingPosition:{type:Object,default:void 0}},mt=["dragMove"],ye=T({name:"GridItem",props:vt,emits:mt,setup(e){const n=N(),a=ce(Se);if(!a)throw new Error("TODO");C(()=>{t()}),de(()=>e.droppingPosition,(l,F)=>{t(F)},{deep:!0});function t(l){var M;if(!e.droppingPosition)return;const F=(M=n.value)==null?void 0:M.$el;if(!F)return;const S=l||{left:0,top:0},$=i.value&&e.droppingPosition.left!==S.left||e.droppingPosition.top!==S.top;if(!i.value)p(e.droppingPosition.evt,{node:F,deltaX:e.droppingPosition.left,deltaY:e.droppingPosition.top,x:0,y:0,lastX:0,lastY:0});else if($){const B=e.droppingPosition.left-S.left,_=e.droppingPosition.top-S.top;k(e.droppingPosition.evt,{node:F,deltaX:B,deltaY:_,x:0,y:0,lastX:0,lastY:0})}}const{x:r,y:u,width:x,height:c,dragging:i,style:g,minWidth:h,minHeight:y,onDragStart:p,onDrag:k,onDragStop:E,onResizeStart:f,onResize:m,onResizeStop:w}=it(e,a),d=l=>{const F={width:x.value,height:c.value,scale:e.scale,dragOpts:{disabled:!e.isResizable},minWidth:h.value,minHeight:y.value,startFn:f,resizeFn:m,stopFn:w};return A(Re,{},F)(()=>l)};return{x:r,y:u,width:x,height:c,style:g,dragging:i,onDragStart:p,onDrag:k,onDragStop:E,onResizeStart:f,onResize:m,onResizeStop:w,dragNode:l=>{const F={class:[i.value&&"vv-grid-layout--item__draggable","vv-grid-layout--item",!e.isDraggable&&"vv-grid-layout--item__disabled"],style:g.value,ref:n},S={disabled:!e.isDraggable,startFn:p,stopFn:E,dragFn:k};return A(ve,F,S)(()=>d(l))}}},render(){const{slots:e}=te(),n=e;return this.dragNode(n)}});function gt(e,n){const a=N(),t=N();function r(u){u.preventDefault(),u.stopPropagation();const x=u.currentTarget.getBoundingClientRect(),c=u.clientX-x.left,i=u.clientY-x.top,g={left:c,top:i,evt:u};if(a.value){if(t.value){const{left:h,top:y}=t.value;h!==c&&y!==i&&(t.value=g)}}else{a.value=A("div",{key:n.droppingItem.i}),t.value=g;const h={cols:n.cols,margin:n.margin,maxRows:n.maxRows,rowHeight:n.rowHeight,width:n.width,containerPadding:n.containerPadding||n.margin},y=Ue(h,c,i,n.droppingItem.w,n.droppingItem.h);e.updateDroppingItem({...n.droppingItem,x:y.x,y:y.y,static:!1,isDraggable:!0})}}return{onDropover:r,droppingNode:a,position:t}}const yt={droppable:Boolean,droppingItem:{type:Object,default:()=>({i:"__dropping-elem__",w:1,h:1})},modelValue:{type:Array,required:!0,default:()=>[]},autoHeight:{type:Boolean,default:!0},cols:{type:Number,default:12},maxRows:{type:Number,default:1/0},minW:{type:Number,default:1},minH:{type:Number,default:1},rowHeight:{type:Number,default:150},width:{type:Number,default:1200},margin:{type:Array,default:()=>[10,10]},containerPadding:{type:Array,default:void 0},disabledDrag:Boolean,disabledResize:Boolean,collision:Boolean},pt=T({name:"GridLayout",inheritAttrs:!1,props:yt,emits:["update:modelValue","dropItem"],setup(e,{emit:n}){const a=lt(U(De(e))),t=gt(a,e);Fe(Se,a);const r=N(null);function u(p,k=!1){const E=p.key;if(!E)return;const f=a.getItem(String(E));if(!f)return;const m=!f.static&&!e.disabledDrag,w=!f.static&&!e.disabledResize,d={x:f.x,y:f.y,width:f.w,height:f.h,isDraggable:m,isResizable:w,scale:f.scale,droppingPosition:k?t.position.value:void 0,dragEndFn:(b,l)=>{const{x:F,y:S}=l,$=a.moveTo(f,F,S);n("update:modelValue",$),r.value=null},dragStartFn:()=>{},dragFn:(b,l)=>{if(!f)return;const F={x:f.x,y:f.y,width:f.w,height:f.h},{x:S,y:$}=l;a.moveTo(f,S,$),r.value=F},resizeFn:(b,l)=>{const F={x:f.x,y:f.y,width:f.w,height:f.h};r.value=F;const{w:S,h:$}=l;a.resizeTo(f,S,$)},resizeStopFn:(b,l)=>{const{w:F,h:S}=l,$=a.resizeTo(f,F,S);n("update:modelValue",$),r.value=null}};return A(ye,{},d)({default:()=>p})}function x(){if(!r.value)return null;const{x:p,y:k,width:E,height:f}=r.value;return A(ye,{class:"vv-grid-layout--placeholder"},{x:p,y:k,width:E,height:f,move:!1})()}function c(){const p=a.getFull(),k=a.normalize(p.filter(E=>E.i!==e.droppingItem.i));a.setFull(k)}let i=0;function g(p){p.stopPropagation(),p.preventDefault();const k=a.getItem(e.droppingItem.i);c(),t.droppingNode.value=null,t.position.value=null,r.value=null,i=0,n("dropItem",k)}function h(p){p.stopPropagation(),p.preventDefault(),--i,i===0&&c()}function y(p){p.stopPropagation(),p.preventDefault(),++i}return{processItem:u,placeholder:x,onDrop:g,onDragLeave:h,onDragEnter:y,layout:a,droppingItem:t}},render(){const e={...this.$attrs.style||{},height:this.layout.calContainerHeight()},a=[...(Array.isArray(this.$attrs.class)?this.$attrs.class:[this.$attrs.class])||[],"vv-grid-layout"],t=typeof this.$slots.default=="function"?this.$slots.default():this.$slots.default||[],r=Ne(t);return K("div",{class:a,style:e,onDragover:this.droppable?this.droppingItem.onDropover:Z,onDrop:this.droppable?this.onDrop:Z,onDragleave:this.droppable?this.onDragLeave:Z,onDragenter:this.droppable?this.onDragEnter:Z},[r.map(u=>(u.type===ue&&this.processItem(u),this.processItem(u))),this.droppable&&this.droppingItem.droppingNode.value&&this.processItem(this.droppingItem.droppingNode.value(),!0),this.placeholder()])}});function Z(){}function Ne(e){const n=[];return e.forEach(a=>{a.type===ue&&Array.isArray(a.children)?n.push(...Ne(a.children)):n.push(a)}),n}const Dt=ft,_t=pt,zt=dt;export{zt as F,_t as G,Ft as _,Dt as a};
