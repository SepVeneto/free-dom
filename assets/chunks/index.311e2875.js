import{u as Be,a as pe,b as He,o as Pe}from"./theme.59733ceb.js";import{r as S,a as C,a1 as we,e as T,c as R,C as $e,f as ge,h as Xe,x as Ye,H as Ie,m as Le,l as Ve,O as We,u as be,J as Ae,p as Oe,i as Te,F as ue,a2 as K,N as de,E as ee,a3 as U,$ as Ge,d as Q,B as xe,w as ce,a4 as je,V as Fe,a5 as De}from"./framework.770d1f77.js";function Ke(e){const n=S(1200);C(()=>{t(),window.addEventListener("resize",a)}),we(()=>{window.removeEventListener("resize",a)});const a=Be(t);function t(){var r;n.value=((r=e.value)==null?void 0:r.getBoundingClientRect().width)||1200}return n}const Ft=T({__name:"vp-demo",props:{source:{},demos:{},path:{}},setup(e){const n=S(),a=Ke(n),t=e,r=R(()=>t.path.startsWith("grid-layout")),u=R(()=>({border:"1px solid black",width:r.value?"":"100%",height:r.value?"":"300px"})),b=R(()=>{const d=Object.keys(t.demos);for(const i of d)if(i.replace("../examples/","").replace(".vue","")===t.path)return t.demos[i].default;return!1});return(d,i)=>{const y=$e("ClientOnly");return ge(),Xe(ue,null,[Ye("section",{ref_key:"wrapRef",ref:n,style:{width:"100%"}},[Ie(y,null,{default:Le(()=>[b.value?(ge(),Ve(Ae(b.value),{key:0,style:We(u.value),width:be(a)},null,8,["style","width"])):Oe("",!0)]),_:1})],512),Te(d.$slots,"source")],64)}}});const he=Symbol("Scene");function A(e,n={},a={},t={}){if(!e)return()=>null;const r=Je(t),u={...n,...a,...r};return b=>K(e,u,b)}const qe=/^nativeOn([A-Z]\S*)/;function Je(e){const n={};let a=!1;Object.entries(e).forEach(([r,u])=>{{a=!0;const b=r.replace(qe,(d,i)=>`on${i}`);n[b]=u}});const t={};return a&&(t.on=n),t.on}function W(e,n,a=1/0){return Math.max(Math.min(e,a),n)}function oe(...e){}function _e(e){if(e){if(!e.getElementById("free-dom-style-el")){const n=e.createElement("style");n.id="free-dom-style-el",n.innerHTML=".free-dom-transparent-selection *::selection {all: inherit;}",e.getElementsByTagName("head")[0].appendChild(n)}e.body&&e.body.classList.add("free-dom-transparent-selection")}}function re(e){if(!e)return;e.body&&e.body.classList.remove("free-dom-transparent-selection");const n=e.getSelection();n&&n.removeAllRanges()}function Ue(e,n,a,t,r){const{margin:u,cols:b,rowHeight:d,maxRows:i}=e,y=Ze(e);let h=Math.round((n-u[0])/(y+u[0])),m=Math.round(a-u[1]/(d+u[1]));return h=W(h,0,b-t),m=W(m,0,i-r),{x:h,y:m}}function Ze(e){const{margin:n,containerPadding:a,width:t,cols:r}=e;return(t-n[0]*(r-1)-a[0]*2)/r}const Qe=["xt","xc","xb","yl","yc","yr"],Ce=T({props:{showLine:Boolean},setup(){const e=de(he),n=ee(Qe),a=R(()=>e.diff/e.transformScale),t=e.nodes,r=R(()=>t.filter(h=>!h.node.selected)),u=U({xt:{show:!1,pos:0},xc:{show:!1,pos:0},xb:{show:!1,pos:0},yl:{show:!1,pos:0},yc:{show:!1,pos:0},yr:{show:!1,pos:0}}),b=(h,m)=>{var k;const w=(k=t.find(E=>E.uuid===h))==null?void 0:k.node;w&&(d(),r.value.forEach(E=>{if(E.uuid===h)return;const f=i(w._rect),g=i(E.node._rect);y(f.top,g.top,m)&&(u.xt={show:!0,pos:g.top},w._rect.y=g.top),y(f.bottom,g.top,m)&&(u.xt={show:!0,pos:g.top},w._rect.y=g.top-f.height),y(f.centerY,g.centerY,m)&&(u.xc={show:!0,pos:g.centerY},w._rect.y=g.centerY-f.height/2),y(f.top,g.bottom,m)&&(u.xb={show:!0,pos:g.bottom},w._rect.y=g.bottom),y(f.bottom,g.bottom,m)&&(u.xb={show:!0,pos:g.bottom},w._rect.y=g.bottom-f.height),y(f.left,g.left,m)&&(u.yl={show:!0,pos:g.left},w._rect.x=g.left),y(f.right,g.left,m)&&(u.yl={show:!0,pos:g.left},w._rect.x=g.left-f.width),y(f.centerX,g.centerX,m)&&(u.yc={show:!0,pos:g.centerX},w._rect.x=g.centerX-f.width/2),y(f.left,g.right,m)&&(u.yr={show:!0,pos:g.right},w._rect.x=g.right),y(f.right,g.right,m)&&(u.yr={show:!0,pos:g.right},w._rect.x=g.right-f.width)}))};e==null||e.on("move",b),e==null||e.on("moveup",d),we(()=>{e==null||e.off("move"),e==null||e.off("moveup")});function d(){u.xt.show=!1,u.xc.show=!1,u.xb.show=!1,u.yl.show=!1,u.yc.show=!1,u.yr.show=!1}function i(h){return{deltaX:h.deltaX,deltaY:h.deltaY,top:h.y,bottom:h.y+h.height,left:h.x,right:h.x+h.width,width:h.width,height:h.height,centerX:h.x+h.width/2,centerY:h.y+h.height/2}}function y(h,m,w){const k=w?0:a.value;return Math.abs(h-m)<=k}return{lines:n,diff:a,lineStatus:u}},render(){const e=(a,t)=>K("div",{style:{[a.includes("x")?"top":"left"]:t.pos+"px"},class:[a.includes("x")?"vv-free-dom--xline":"vv-free-dom--yline","vv-free-dom--line"]}),n=this.showLine?this.lines.filter(a=>this.lineStatus[a].show).map(a=>e(a,this.lineStatus[a])):[];return K("div",{class:"vv-free-dom--markline"},n)}});function te(){const e=Ge(),n=typeof e.default=="function"?e.default():e.default,a=n==null?void 0:n[0];return{slots:n,only:a}}function et(e){const n=S(NaN),a=S(NaN);function t(r,u){const b=isNaN(n.value),d=be(e);if(!d)throw new Error("drag node does not exist");return b?{node:d,deltaX:0,deltaY:0,lastX:r,lastY:u,x:r,y:u}:{node:d,deltaX:r-n.value,deltaY:u-a.value,lastX:n.value,lastY:a.value,x:r,y:u}}return{lastX:n,lastY:a,create:t}}function tt(e){const n=S(e.x||e.modelValue.x||0),a=S(e.y||e.modelValue.y||0),t=S(0),r=S(0),u=S();Q(()=>{n.value=e.x||e.modelValue.x||0}),Q(()=>{a.value=e.y||e.modelValue.y||0});const b=(h,m)=>{e.dragStartFn(h,m)},d=(h,m)=>{n.value=Number(m.x.toFixed(2)),a.value=Number(m.y.toFixed(2)),t.value=m.deltaX,r.value=m.deltaY,e.dragFn(h,m)},i=(h,m)=>{const w=u.value=y(m);e.dragStopFn(h,w)};function y(h){return{node:h.node,x:n.value+h.deltaX,y:a.value+h.deltaY,deltaX:h.deltaX,deltaY:h.deltaY,lastX:n.value,lastY:a.value}}return{x:n,y:a,deltaX:t,deltaY:r,create:y,handleDragStart:b,handleDrag:d,handleDragStop:i}}let nt=0;function at(e,n,a){const t=de(he,void 0),r=nt++,u=R(()=>(t==null?void 0:t.handle)||a.handle),b=R(()=>(t==null?void 0:t.lockAspectRatio)||a.lockAspectRatio),d=R(()=>(t==null?void 0:t.minWidth)||a.minWidth),i=R(()=>(t==null?void 0:t.minHeight)||a.minHeight),y=R(()=>(t==null?void 0:t.disabledDrag)||a.disabledDrag),h=R(()=>(t==null?void 0:t.disabledResize)||a.disabledResize),m=R(()=>(t==null?void 0:t.disabledSelect)||a.disabledSelect),w=R(()=>(t==null?void 0:t.scale)||a.scale),k=R(()=>(t==null?void 0:t.transformScale)||a.transformScale),E=R(()=>(t==null?void 0:t.fixNonMonospaced)||a.fixNonMonospaced),f=R(()=>(t==null?void 0:t.keyboard)||a.keyboard);C(()=>{const c=e.value;if(!c){console.warn("[free-dom] mounted failed: element not found");return}t==null||t.register(c.$el,r,n)}),xe(()=>{t==null||t.remove(r)});function g(c){return t?t.checkValid(c):!0}function p(c){return t?t.correct(c):c}return{emit:(c,F)=>{t==null||t.emit(c,r,F)},check:g,correct:p,clearSelectState:t==null?void 0:t.clearSelectState,width:t==null?void 0:t.width,height:t==null?void 0:t.height,history:t==null?void 0:t.history,scale:w,handle:u,lockAspectRatio:b,minWidth:d,minHeight:i,disabledDrag:y,disabledResize:h,disabledSelect:m,fixNonMonospaced:E,transformScale:k,keyboard:f}}const q=S({});function fe(){return{on:(t,r)=>{q.value[t]?q.value[t].push(r):q.value[t]=[r]},off:t=>{q.value[t].length=0},emit:(t,...r)=>{(q.value[t]||[]).forEach(b=>b(...r))}}}function ot(e,n){const a=S(r()),t=S(u());Q(()=>{a.value=r()}),Q(()=>{t.value=u()});function r(){return e.width||e.modelValue.w}function u(){return e.height||e.modelValue.h}async function b(d,i,y){if(e.width&&e.height||e.modelValue.w&&e.modelValue.h)return;if(!n.value)return[0,0];d&&await document.fonts.ready;const{width:h,height:m}=window.getComputedStyle(n.value.$el);a.value=Math.max(Math.ceil(parseFloat(h)),i),t.value=Math.max(Math.ceil(parseFloat(m)),y)}return{width:a,height:t,syncSize:b}}function lt(e){const n=ee(e.modelValue);ce(()=>e.modelValue,()=>{n.value=e.modelValue},{deep:!0});const a=R(()=>{var s;return(e.width-u.value[0]*(t.value-1)-(((s=d.value)==null?void 0:s[0])||u.value[0])*2)/e.cols}),t=R(()=>e.cols),r=R(()=>e.rowHeight),u=R(()=>e.margin),b=R(()=>e.maxRows),d=R(()=>e.containerPadding),i=R(()=>e.minW),y=R(()=>e.minH);function h(s){return n.value.find(o=>o.i===s)}function m(){return n.value}function w(s){n.value=s}function k(s,o,v,N,P,X){if(o.static||o.y===N&&o.x===v)return s;oe(`Moving element ${o.i} to [${String(v)},${String(N)}] from [${o.x},${o.y}]`);const D=o.x,$=o.y;typeof v=="number"&&(o.x=v),typeof N=="number"&&(o.y=N),o.moved=!0;const I=p(s).filter(L=>c(L,o));return I.length>0&&X?(o.x=D,o.y=$,o.moved=!1,s):(I.forEach(L=>{oe(`Resolving collision between ${o.i} at [${o.x},${o.y}] and ${L.i} at [${L.x},${L.y}]`,L.moved,L.i),!L.moved&&(L.static?s=E(s,L,o,P):s=E(s,o,L,P))}),s)}function E(s,o,v,N){const P=o.static;if(N){N=!1;const X={x:v.x,y:Math.max(o.y-v.h,0),w:v.w,h:v.h,i:"-1"};if(!F(s,X))return oe(`Doing reverse collision on ${v.i} up to [${X.x},${X.y}].`),k(s,v,void 0,X.y,N,P)}return k(s,v,void 0,v.y+1,N,P)}function f(s,o,v){const P=k(n.value,s,o,v,!0,!e.collision);return n.value=l(P),n.value}function g(s,o,v){let N=!1;if(!e.collision){const P=n.value.filter(X=>c(X,{...s,w:o,h:v}));if(N=P.length>0,N){let X=1/0,D=1/0;P.forEach($=>{$.x>s.x&&(X=Math.min($.x,X)),$.y>s.y&&(D=Math.min($.y,D))}),Number.isFinite(X)&&(s.w=X-s.x),Number.isFinite(D)&&(s.h=D-s.y)}}return N||(s.w=o,s.h=v),n.value=l([...n.value]),n.value}function p(s){return s.slice(0).sort((o,v)=>o.y>v.y||o.y===v.y&&o.x>v.x?1:o.y===v.y&&o.x===v.x?0:-1)}function c(s,o){return s.i===o.i||s.x+s.w<=o.x||s.x>=o.x+o.w||s.y+s.h<=o.y?!1:!(s.y>=o.y+o.h)}function F(s,o){for(let v=0;v<s.length;++v)if(c(s[v],o))return s[v]}function l(s){const o=s.filter(P=>P.static),v=p(s),N=new Array(s.length);return v.forEach((P,X)=>{let D=JSON.parse(JSON.stringify(P));D.static||(D=x(o,D,v),o.push(D)),N[s.indexOf(v[X])]=D,D.moved=!1}),N}function x(s,o,v){if(e.collision)for(o.y=Math.min(z(s),o.y);o.y>0&&!F(s,o);)--o.y;let N;for(;(N=F(s,o))&&e.collision;)H(v,o,N.y+N.h,"y");return o}function z(s){let o=0;return s.forEach(v=>{const N=v.y+v.h;N>o&&(o=N)}),o}function B(){var o;if(!e.autoHeight)return;const s=z(n.value);return`${s*e.rowHeight+u.value[1]*(s-1)+(((o=d.value)==null?void 0:o[1])||u.value[1])*2}px`}const M={x:"w",y:"h"};function H(s,o,v,N){const P=M[N];o[N]+=1;const X=s.findIndex(D=>D===o);for(let D=X+1;D<s.length;++D){const $=s[D];if($.y>o.y+o.h)break;c(o,$)&&H(s,$,v+o[P],N)}o[N]=v}function _(s){n.value=[...n.value,s]}return{cellWidth:a,cols:t,rowHeight:r,margin:u,maxRows:b,containerPadding:d,minW:i,minH:y,updateDroppingItem:_,calContainerHeight:B,moveTo:f,resizeTo:g,getItem:h,getFull:m,setFull:w,normalize:l}}function it(e,n){const{cellWidth:a,margin:t,rowHeight:r,cols:u,maxRows:b,containerPadding:d}=n,i=S(),y=S(),h=R(()=>d.value||t.value),m=R(()=>i.value?Math.round(i.value.x):Math.round(e.x*(a.value+t.value[0])+h.value[0])),w=R(()=>i.value?Math.round(i.value.y):Math.round(e.y*(r.value+t.value[1])+h.value[1])),k=R(()=>y.value?Math.round(y.value.width):Math.round(a.value*e.width+Math.max(0,e.width-1)*t.value[0])),E=R(()=>y.value?Math.round(y.value.height):Math.round(r.value*e.height+Math.max(0,e.height-1)*t.value[1])),f=R(()=>{const _=n.minW.value;return Math.round(a.value*_+Math.max(0,_-1)*t.value[0])}),g=R(()=>{const _=n.minH.value;return Math.round(r.value*_+Math.max(0,_-1)*t.value[1])}),p=R(()=>({position:"absolute",width:`${k.value}px`,height:`${E.value}px`,transform:`translate(${m.value}px, ${w.value}px)`})),c=(_,{node:s})=>{const o=s.offsetParent.getBoundingClientRect(),v=s.getBoundingClientRect();i.value={x:v.left-o.left+s.offsetParent.scrollLeft,y:v.top-o.top+s.offsetParent.scrollTop}},F=(_,s)=>{if(!i.value)throw new Error("onDrag called before onDragStart");const{deltaX:o,deltaY:v}=s,N=i.value.x+o,P=i.value.y+v;i.value={x:N,y:P};const{x:X,y:D}=M(N,P);e.dragFn(_,{x:X,y:D})},l=_=>{if(!i.value)throw new Error("onDragStop called before onDratStart");const{x:s,y:o}=i.value,{x:v,y:N}=M(s,o);i.value=void 0,e.dragEndFn(_,{x:v,y:N})},x=(_,{width:s,height:o})=>{y.value={width:s,height:o}},z=(_,s)=>{const{width:o,height:v}=s,{w:N,h:P}=H(o,v);y.value={width:o,height:v},e.resizeFn(_,{w:N,h:P})},B=(_,s)=>{y.value=void 0;const{width:o,height:v}=s,{w:N,h:P}=H(o,v);e.resizeStopFn(_,{w:N,h:P})};function M(_,s){let o=Math.round((_-t.value[0])/(a.value+t.value[0])),v=Math.round((s-t.value[1])/(r.value+t.value[1]));return o=W(o,0,u.value-e.width),v=W(v,0,b.value-e.height),{x:o,y:v}}function H(_,s){let o=Math.round((_+t.value[0])/(a.value+t.value[0])),v=Math.round((s+t.value[1])/(r.value+t.value[1]));return o=W(o,0,u.value-e.x),v=W(v,0,b.value-e.y),{w:o,h:v}}return{x:m,y:w,width:k,height:E,dragging:i,resizing:y,style:p,minWidth:f,minHeight:g,onDragStart:c,onDrag:F,onDragStop:l,onResizeStart:x,onResize:z,onResizeStop:B}}function st(e,n,a){const t=fe(),r=S(0),u=S(0),b=S(0),d=S(0),i=ze(a),y=S(!1),h=R(()=>{const M=b.value-r.value,H=d.value-u.value;return{visibility:m.value?"visible":"hidden",border:"2px solid rgb(0,120,215)",background:"rgb(0,120,215,0.3)",position:"absolute",top:u.value+(H<0?H:0)+"px",left:r.value+(M<0?M:0)+"px",width:Math.abs(M)+"px",height:Math.abs(H)+"px",zIndex:1}}),m=S(!1),w=pe(e),k=R(()=>{var M;return(M=He(e))==null?void 0:M.ownerDocument}),E=R(()=>a.value.filter(M=>!(n.disabledSelect||M.node.disabledSelect)));function f(){let M;E.value.forEach(H=>{const _=H.node._rect;if(_.x==null||_.y==null||_.width==null||_.height==null)return!1;const s=_.x,o=_.y,v=s+_.width,N=o+_.height,P=g(s,o,v,N);H.node.selected=P,P&&(M=H)}),M==null||M.el.focus()}function g(M,H,_,s){const o=Math.min(r.value,b.value),v=Math.min(u.value,d.value),N=Math.max(r.value,b.value),P=Math.max(u.value,d.value),X=p(o,N,M,_,Math.abs(M-_)/5),D=p(v,P,H,s,Math.abs(H-s)/5);return X&&D}function p(M,H,_,s,o){return Math.max(M,_)-Math.min(H,s)<=-o}function c(M){const H=M.clientX-w.x.value,_=M.clientY-w.y.value;return{x:H,y:_}}function F(M){if(n.disabledBatch)return;_e(k.value);const{x:H,y:_}=c(M);m.value=!0,r.value=H,u.value=_,b.value=H,d.value=_,document.addEventListener("mouseup",x)}function l(M){if(!m.value)return;y.value||(t.emit("batch-select","start"),y.value=!0);const{x:H,y:_}=c(M);b.value===H&&d.value===_||(b.value=H,d.value=_,B())}function x(){re(k.value),m.value=!1,y.value=!1,b.value===r.value&&d.value===u.value||i.push({type:"batch-select"}),document.removeEventListener("mouseup",x),b.value=0,d.value=0,r.value=0,u.value=0,setTimeout(()=>{t.emit("batch-select","end")})}function z(){return K("div",{id:"mask",style:h.value})}async function B(){f()}return{selecting:m,renderMask:z,handleMousedown:F,handleMousemove:l}}const le=S([]),rt=S({canClear:!1});function ze(e){const n=R(()=>{var t;return(t=le.value.slice(-1)[0])==null?void 0:t.type});function a(t){le.value.push({...t,data:e})}return{state:rt,records:le,lastOperate:n,push:a}}function ie(){}const ut={userSelectHack:{type:Boolean,default:!0},startFn:{type:Function,default:ie},stopFn:{type:Function,default:ie},dragFn:{type:Function,default:ie},disabled:Boolean,scale:{type:Number,default:1}},ve=T({name:"FreeDomCore",props:ut,setup(e){const n=S(!1),a=S(),t=R(()=>{var c;return((c=a.value)==null?void 0:c.$el)||a.value}),r=R(()=>{var c;return(c=t.value)==null?void 0:c.ownerDocument}),{lastX:u,lastY:b,create:d}=et(t),i=S(NaN),y=S(NaN);let h,m;xe(()=>{r.value&&(e.userSelectHack&&re(r.value),r.value.removeEventListener("mousemove",g),r.value.removeEventListener("mouseup",f))});function w(c){return E(c)}function k(c){f(c)}function E(c){var z,B;if(e.disabled||!c.target||!(c.target instanceof t.value.ownerDocument.defaultView.Node))return;const{x:F,y:l}=p(c),x=d(F,l);e.startFn(c,x),i.value=F,y.value=l,u.value=F,b.value=l,n.value=!0,e.userSelectHack&&_e(r.value),(z=r.value)==null||z.addEventListener("mousemove",g),(B=r.value)==null||B.addEventListener("mouseup",f)}function f(c){var F,l;if(n.value){if(!(i.value===u.value&&y.value===b.value)){const{x,y:z}=p(c),B=d(x,z);e.stopFn(c,B)}e.userSelectHack&&re(r.value),n.value=!1,u.value=NaN,b.value=NaN,(F=r.value)==null||F.removeEventListener("mousemove",g),(l=r.value)==null||l.removeEventListener("mouseup",f)}}function g(c){const{x:F,y:l}=p(c),x=d(F,l);e.dragFn(c,x),u.value=F,b.value=l}function p(c){var B;const F=((B=t.value)==null?void 0:B.offsetParent)||r.value.body,l=F===F.ownerDocument.body;(!h||h!==F)&&(h=F,m=l?{left:0,top:0}:F.getBoundingClientRect());const x=(c.clientX+F.scrollLeft-m.left)/e.scale,z=(c.clientY+F.scrollTop-m.top)/e.scale;return{x,y:z}}return{coreRef:a,mousedownFn:w,mouseupFn:k}},render(){const{only:e}=te(),n=A(e,{ref:a=>{this.coreRef=a}},{},{onMousedown:a=>{a.stopPropagation(),this.mousedownFn(a)},onMouseup:this.mouseupFn});return typeof n=="function"?n():n}}),dt=["t","r","l","b","lt","lb","rt","rb"];function se(){}const J={dragOpts:{type:Object,default:()=>({})},width:{type:Number,default:0},height:{type:Number,default:0},scale:{type:[Boolean,Array],default:void 0},startFn:{type:Function,default:se},stopFn:{type:Function,default:se},resizeFn:{type:Function,default:se},minWidth:{type:Number,default:50},minHeight:{type:Number,default:50},lockAspectRatio:Boolean},Ne=T({name:"ResizeDomCore",props:J,setup(e,{slots:n}){const a=R(()=>{const d=e.scale;return Array.isArray(d)?d:dt}),t=ee();function r(d,i,y){const{lockAspectRatio:h}=e;if(!e.minHeight&&!e.minWidth&&!h)return[d,i];if(h&&y.length===2){const m=e.width/e.height;m>1?(i=Math.max(i,e.minHeight),d=i*m):(d=Math.max(d,e.minWidth),i=d/m)}else d=Math.max(d,e.minWidth),i=Math.max(i,e.minHeight);return[d,i]}function u(d,i){return(y,{node:h,deltaX:m,deltaY:w})=>{d==="start"&&(t.value=void 0);const k=i!=="t"&&i!=="b",E=i!=="l"&&i!=="r",f=i[0],g=i[i.length-1],p=h.getBoundingClientRect();t.value=p,f==="l"&&(m=-m),g==="t"&&(w=-w);let c=e.width+(k?m:0),F=e.height+(E?w:0);y.shiftKey||([c,F]=r(c,F,i));const l=c!==e.width||F!==e.height,x=`${d}Fn`,z=typeof e[x]=="function"?e[x]:null;z&&!(d==="resize"&&!l)&&z(y,{node:h,width:c,height:F,handle:i}),d==="stop"&&(t.value=void 0)}}function b(d){return n.handler?()=>{var i;return(i=n.handler)==null?void 0:i.call(n,d)}:()=>K("i",{dataType:"handler",class:["vv-resize-dom--handler",`vv-resize-dom--handler__${d}`]})}return{dots:a,handleResize:u,renderResizehandler:b}},render(){const{slots:e}=te(),n=[...e||[],this.dots.map(a=>A(ve,{class:[this.dragOpts.disabled&&"vv-resize-dom--disabled"]},{...this.dragOpts,stopFn:this.handleResize("stop",a),startFn:this.handleResize("start",a),dragFn:this.handleResize("resize",a)})(this.renderResizehandler(a)))];return A("div",{class:"vv-resize-dom--box"})(n)}});function G(){}const O={modelValue:{type:Object,default:()=>({})},keyboard:Boolean,x:{type:Number,default:0},y:{type:Number,default:0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},handle:{type:String,default:void 0},lockAspectRatio:Boolean,dragStartFn:{type:Function,default:G},dragStopFn:{type:Function,default:G},dragFn:{type:Function,default:G},resizeStartFn:{type:Function,default:G},resizeFn:{type:Function,default:G},resizeStopFn:{type:Function,default:G},autoSize:{type:Boolean,default:!0},minWidth:J.minWidth,minHeight:J.minHeight,disabledDrag:Boolean,disabledResize:Boolean,disabledSelect:Boolean,scale:J.scale,transformScale:{type:Number,default:1},fixNonMonospaced:Boolean},ct=T({name:"FreeDom",props:O,emits:["update:width","update:height","update:x","update:y","update:modelValue"],setup(e,{emit:n,expose:a,slots:t}){const r=S(),u=S(!1);fe().on("batch-select",D=>{u.value=D==="start"});const{x:d,y:i,deltaX:y,deltaY:h,create:m,handleDragStart:w,handleDrag:k,handleDragStop:E}=tt(e),{width:f,height:g,syncSize:p}=ot(e,r),c=S(!1),F=U({disabledSelect:je(e,"disabledSelect"),selected:c,_rect:U({x:d,y:i,width:f,height:g,deltaX:y,deltaY:h}),trigger:D=>{n("update:modelValue",D)},props:e}),l=at(r,F,e);Pe(r,()=>{!c.value||u.value||(c.value=!1)},{ignore:[l.clearSelectState&&".vv-free-dom--draggable"]});const x=()=>{p(l.fixNonMonospaced.value,l.minWidth.value,l.minHeight.value)},z=S(!1);C(()=>{e.autoSize&&x()});const B=R(()=>({width:`${f.value}px`,height:`${g.value}px`,transform:`translate(${d.value}px, ${i.value}px)`})),M=(D,$)=>{var L;if(!z.value)return;const Y=m($),I={x:Y.x,y:Y.y,width:f.value,height:g.value};(L=l.check)!=null&&L.call(l,I)&&(k(D,Y),l.emit("move",D.shiftKey))},H=(D,$)=>{var V,L;if(!z.value)return;const Y={x:d.value,y:i.value,width:f.value,height:g.value};((V=l.check)==null?void 0:V.call(l,Y))||(d.value=W(d.value,0,l.width),i.value=W(i.value,0,l.height)),E(D,$),l.emit("moveup"),n("update:x",d.value),n("update:y",i.value),n("update:modelValue",{x:d.value,y:i.value,w:f.value,h:g.value}),(L=l.history)==null||L.push({type:"move-end"})},_=(D,$)=>{const Y=l.handle.value;Y?Y.startsWith(".")?z.value=D.target.classList.contains(Y.slice(1)):Y.startsWith("#")?z.value=D.target.id===Y.slice(1):(console.warn(`[free-dom] can not find element with ${Y}`),z.value=!0):z.value=!0,z.value&&w(D,$)},s=(D,{node:$,width:Y,height:I,handle:V})=>{var me;const L=-(Y-f.value),ke=-(I-g.value),Me=V[0],Ee=V[V.length-1];let ne=d.value,ae=i.value;Me==="l"&&(ne+=L),Ee==="t"&&(ae+=ke),(me=l.check)!=null&&me.call(l,{x:ne,y:ae,width:Y,height:I})&&(f.value=Number(Y.toFixed(2)),g.value=Number(I.toFixed(2)),d.value=Number(ne.toFixed(2)),i.value=Number(ae.toFixed(2)),e.resizeFn(D,{node:$,width:Y,height:I,handle:V}),l==null||l.emit("move"))},o=(D,$)=>{var I,V;((I=l.check)==null?void 0:I.call(l,{x:d.value,y:i.value,width:f.value,height:g.value}))||(d.value=W(d.value,0,l.width),i.value=W(i.value,0,l.height)),e.resizeStopFn(D,$),n("update:width",f.value),n("update:height",g.value),n("update:modelValue",{x:d.value,y:i.value,w:f.value,h:g.value}),l.emit("moveup"),(V=l.history)==null||V.push({type:"resize-end"})},v=(D,$)=>{e.resizeStartFn(D,$)},N=()=>{const D={width:f.value,height:g.value,lockAspectRatio:l.lockAspectRatio.value,dragOpts:{disabled:l.disabledResize.value,scale:l.transformScale.value},startFn:v,resizeFn:s,stopFn:o,minHeight:l.minHeight.value,minWidth:l.minWidth.value,scale:l.scale.value};return A(Ne,{},D)(t)};function P(D){var $,Y,I;l.disabledSelect.value||(D.ctrlKey?(c.value=!c.value,($=l.history)==null||$.push({type:"select"})):c.value||((Y=l.clearSelectState)==null||Y.call(l),c.value=!0,(I=l.history)==null||I.push({type:"select"})))}function X(D){var I;if(l.disabledDrag.value||!l.keyboard.value)return;switch(D.preventDefault(),D.key){case"ArrowUp":h.value=-1,y.value=0;break;case"ArrowDown":h.value=1,y.value=0;break;case"ArrowLeft":y.value=-1,h.value=0;break;case"ArrowRight":y.value=1,h.value=0;break;default:y.value=0,h.value=0}d.value+=y.value,i.value+=h.value;const $={x:d.value,y:i.value,width:f.value,height:g.value};((I=l.check)==null?void 0:I.call(l,$))||(d.value=W(d.value,0,l.width),i.value=W(i.value,0,l.height)),n("update:x",d.value),n("update:y",i.value),n("update:modelValue",{x:d.value,y:i.value,w:f.value,h:g.value}),l.emit("move",!0)}return a==null||a({syncSize:x}),{selected:c,domRef:r,style:B,onDragStop:H,onDrag:M,onDragStart:_,resizeNode:N,handleKeyboard:X,handleSelect:P,disabled:l.disabledDrag,scale:l.transformScale}},render(){var a;const e={startFn:this.onDragStart,stopFn:this.onDragStop,dragFn:this.onDrag,disabled:this.disabled,scale:this.scale},n=()=>this.resizeNode();return(a=A(ve,{ref:"domRef",tabindex:-1,class:["vv-free-dom--draggable",this.disabled&&"vv-free-dom--draggable__disabled",this.selected&&"vv-free-dom--draggable__selected"],style:this.style},e,{nativeOnClick:this.handleSelect,nativeOnKeydown:this.handleKeyboard}))==null?void 0:a(n)}}),ht={diff:{type:Number,default:2},showLine:{type:Boolean,default:!0},transformScale:{type:Number,default:1},keyboard:Boolean,disabledBatch:Boolean,handle:O.handle,minWidth:{type:Number,default:void 0},minHeight:{type:Number,default:void 0},lockAspectRatio:O.lockAspectRatio,disabledDrag:O.disabledDrag,disabledResize:O.disabledResize,disabledSelect:O.disabledSelect,scale:O.scale,fixNonMonospaced:O.fixNonMonospaced},ft=T({name:"FreeDomWrap",props:ht,setup(e){const n=fe(),a=S([]),t=ze(a),r=S(0),u=S(0),b=ee(),d=pe(b);ce([d.width,d.height,()=>a.value.length],([p,c])=>{r.value=p,u.value=c,!(!p||!c)&&m()});const i=R(()=>a.value.filter(p=>p.node.selected));n.on("move",p=>{const c=i.value.find(x=>x.uuid===p);if(!c)return;const{deltaX:F,deltaY:l}=c.node._rect;i.value.forEach(x=>{x.uuid!==p&&(x.node._rect.x+=F||0,x.node._rect.y+=l||0)})});const y=S(!1),h=st(b,e,a);function m(){a.value.forEach(p=>{const c=e.minWidth||p.node.props.minWidth,F=e.minHeight||p.node.props.minHeight,{x:l,y:x,width:z,height:B}=f(p.node._rect,c,F);p.node._rect.x=l,p.node._rect.y=x,p.node._rect.width=z,p.node._rect.height=B,p.node.trigger({x:l,y:x,w:z,h:B})})}function w(p,c,F){a.value.push({el:p,uuid:c,node:F})}function k(p){const c=a.value.findIndex(F=>F.uuid===p);a.value.splice(c,1)}function E(p){const{x:c,y:F,width:l,height:x}=p;return c>=0&&c+l<=r.value&&F>=0&&F+x<=u.value}function f(p,c,F){let l=Math.max(p.x,0),x=Math.max(p.y,0),z=p.width,B=p.height;return p.x+p.width>r.value&&(l=r.value-p.width,l<0&&(z=Math.max(r.value,c),l=0)),p.y+p.height>u.value&&(x=u.value-p.height,x<0&&(B=Math.max(u.value,F),x=0)),{x:l,y:x,width:z,height:B}}function g(){i.value.forEach(p=>{p.node.selected=!1})}return Fe(he,U({...De(e),nodes:a,width:r,height:u,history:t,clearSelectState:g,register:w,remove:k,checkValid:E,correct:f,on:n.on,off:n.off,emit:n.emit})),{rectRef:b,selecting:y,mask:h,history:t}},render(){const{slots:e}=te(),n=A(Ce,{},{showLine:this.showLine})(),a=[this.mask.selecting&&this.mask.renderMask(),e,n];return A("section",{ref:"rectRef",class:"vv-free-dom--scene"},{},{onMousedown:this.mask.handleMousedown,onMousemove:this.mask.handleMousemove})(a)}}),Re=Symbol("gridLayoutContext"),j=()=>{},vt={x:{type:Number,required:!0},y:{type:Number,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},dragStartFn:{type:Function,default:j},dragFn:{type:Function,default:j},dragEndFn:{type:Function,default:j},resizeStartFn:{type:Function,default:j},resizeFn:{type:Function,default:j},resizeStopFn:{type:Function,default:j},isDraggable:Boolean,isResizable:Boolean,scale:{type:J.scale.type,default:()=>["rb"]},droppingPosition:{type:Object,default:void 0}},mt=["dragMove"],ye=T({name:"GridItem",props:vt,emits:mt,setup(e){const n=S(),a=de(Re);if(!a)throw new Error("TODO");C(()=>{t()}),ce(()=>e.droppingPosition,(l,x)=>{t(x)},{deep:!0});function t(l){var M;if(!e.droppingPosition)return;const x=(M=n.value)==null?void 0:M.$el;if(!x)return;const z=l||{left:0,top:0},B=i.value&&e.droppingPosition.left!==z.left||e.droppingPosition.top!==z.top;if(!i.value)w(e.droppingPosition.evt,{node:x,deltaX:e.droppingPosition.left,deltaY:e.droppingPosition.top,x:0,y:0,lastX:0,lastY:0});else if(B){const H=e.droppingPosition.left-z.left,_=e.droppingPosition.top-z.top;k(e.droppingPosition.evt,{node:x,deltaX:H,deltaY:_,x:0,y:0,lastX:0,lastY:0})}}const{x:r,y:u,width:b,height:d,dragging:i,style:y,minWidth:h,minHeight:m,onDragStart:w,onDrag:k,onDragStop:E,onResizeStart:f,onResize:g,onResizeStop:p}=it(e,a),c=l=>{const x={width:b.value,height:d.value,scale:e.scale,dragOpts:{disabled:!e.isResizable},minWidth:h.value,minHeight:m.value,startFn:f,resizeFn:g,stopFn:p};return A(Ne,{},x)(()=>l)};return{x:r,y:u,width:b,height:d,style:y,dragging:i,onDragStart:w,onDrag:k,onDragStop:E,onResizeStart:f,onResize:g,onResizeStop:p,dragNode:l=>{const x={class:[i.value&&"vv-grid-layout--item__draggable","vv-grid-layout--item",!e.isDraggable&&"vv-grid-layout--item__disabled"],style:y.value,ref:n},z={disabled:!e.isDraggable,startFn:w,stopFn:E,dragFn:k};return A(ve,x,z)(()=>c(l))}}},render(){const{slots:e}=te(),n=e;return this.dragNode(n)}});function gt(e,n){const a=S(),t=S();function r(u){u.preventDefault(),u.stopPropagation();const b=u.currentTarget.getBoundingClientRect(),d=u.clientX-b.left,i=u.clientY-b.top,y={left:d,top:i,evt:u};if(a.value){if(t.value){const{left:h,top:m}=t.value;h!==d&&m!==i&&(t.value=y)}}else{a.value=A("div",{key:n.droppingItem.i}),t.value=y;const h={cols:n.cols,margin:n.margin,maxRows:n.maxRows,rowHeight:n.rowHeight,width:n.width,containerPadding:n.containerPadding||n.margin},m=Ue(h,d,i,n.droppingItem.w,n.droppingItem.h);e.updateDroppingItem({...n.droppingItem,x:m.x,y:m.y,static:!1,isDraggable:!0})}}return{onDropover:r,droppingNode:a,position:t}}const yt={droppable:Boolean,droppingItem:{type:Object,default:()=>({i:"__dropping-elem__",w:1,h:1})},modelValue:{type:Array,required:!0,default:()=>[]},autoHeight:{type:Boolean,default:!0},cols:{type:Number,default:12},maxRows:{type:Number,default:1/0},minW:{type:Number,default:1},minH:{type:Number,default:1},rowHeight:{type:Number,default:150},width:{type:Number,default:1200},margin:{type:Array,default:()=>[10,10]},containerPadding:{type:Array,default:void 0},disabledDrag:Boolean,disabledResize:Boolean,collision:Boolean},pt=T({name:"GridLayout",inheritAttrs:!1,props:yt,emits:["update:modelValue","dropItem"],setup(e,{emit:n}){const a=lt(U(De(e))),t=gt(a,e);Fe(Re,a);const r=S(null);function u(w,k=!1){const E=w.key;if(!E)return;const f=a.getItem(String(E));if(!f)return;const g=!f.static&&!e.disabledDrag,p=!f.static&&!e.disabledResize,c={x:f.x,y:f.y,width:f.w,height:f.h,isDraggable:g,isResizable:p,scale:f.scale,droppingPosition:k?t.position.value:void 0,dragEndFn:(F,l)=>{const{x,y:z}=l,B=a.moveTo(f,x,z);n("update:modelValue",B),r.value=null},dragStartFn:()=>{},dragFn:(F,l)=>{if(!f)return;const x={x:f.x,y:f.y,width:f.w,height:f.h},{x:z,y:B}=l;a.moveTo(f,z,B),r.value=x},resizeFn:(F,l)=>{const x={x:f.x,y:f.y,width:f.w,height:f.h};r.value=x;const{w:z,h:B}=l;a.resizeTo(f,z,B)},resizeStopFn:(F,l)=>{const{w:x,h:z}=l,B=a.resizeTo(f,x,z);n("update:modelValue",B),r.value=null}};return A(ye,{},c)({default:()=>w})}function b(){if(!r.value)return null;const{x:w,y:k,width:E,height:f}=r.value;return A(ye,{class:"vv-grid-layout--placeholder"},{x:w,y:k,width:E,height:f,move:!1})()}function d(){const w=a.getFull(),k=a.normalize(w.filter(E=>E.i!==e.droppingItem.i));a.setFull(k)}let i=0;function y(w){w.stopPropagation(),w.preventDefault();const k=a.getItem(e.droppingItem.i);d(),t.droppingNode.value=null,t.position.value=null,r.value=null,i=0,n("dropItem",k)}function h(w){w.stopPropagation(),w.preventDefault(),--i,i===0&&d()}function m(w){w.stopPropagation(),w.preventDefault(),++i}return{processItem:u,placeholder:b,onDrop:y,onDragLeave:h,onDragEnter:m,layout:a,droppingItem:t}},render(){const e={...this.$attrs.style||{},height:this.layout.calContainerHeight()},a=[...(Array.isArray(this.$attrs.class)?this.$attrs.class:[this.$attrs.class])||[],"vv-grid-layout"],t=typeof this.$slots.default=="function"?this.$slots.default():this.$slots.default||[],r=Se(t);return K("div",{class:a,style:e,onDragover:this.droppable?this.droppingItem.onDropover:Z,onDrop:this.droppable?this.onDrop:Z,onDragleave:this.droppable?this.onDragLeave:Z,onDragenter:this.droppable?this.onDragEnter:Z},[r.map(u=>(u.type===ue&&this.processItem(u),this.processItem(u))),this.droppable&&this.droppingItem.droppingNode.value&&this.processItem(this.droppingItem.droppingNode.value(),!0),this.placeholder()])}});function Z(){}function Se(e){const n=[];return e.forEach(a=>{a.type===ue&&Array.isArray(a.children)?n.push(...Se(a.children)):n.push(a)}),n}const Dt=ft,_t=pt,zt=ct;export{zt as F,_t as G,Ft as _,Dt as a};
